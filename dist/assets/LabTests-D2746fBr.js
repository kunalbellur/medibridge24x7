var L=Object.defineProperty,z=Object.defineProperties;var E=Object.getOwnPropertyDescriptors;var v=Object.getOwnPropertySymbols;var F=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable;var w=(t,r,l)=>r in t?L(t,r,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[r]=l,m=(t,r)=>{for(var l in r||(r={}))F.call(r,l)&&w(t,l,r[l]);if(v)for(var l of v(r))D.call(r,l)&&w(t,l,r[l]);return t},u=(t,r)=>z(t,E(r));var g=(t,r,l)=>new Promise((N,b)=>{var f=n=>{try{o(l.next(n))}catch(a){b(a)}},x=n=>{try{o(l.throw(n))}catch(a){b(a)}},o=n=>n.done?N(n.value):Promise.resolve(n.value).then(f,x);o((l=l.apply(t,r)).next())});import{u as A,s as j,j as e}from"./index-cCeCS7Tx.js";import{r as p}from"./react-vendor-DnMe622U.js";import{z as c,x as q,X as $,Q as P,W as _,y as I,J as B}from"./ui-vendor-B7h9uWP1.js";import"./supabase-vendor-BUL0ZXqy.js";const U=()=>{const{organization:t}=A(),[r,l]=p.useState([]),[N,b]=p.useState(!0),[f,x]=p.useState(!1),[o,n]=p.useState(null),[a,d]=p.useState({name:"",code:"",description:"",default_price:0,is_active:!0});p.useEffect(()=>{t!=null&&t.id&&y()},[t==null?void 0:t.id]);const y=()=>g(void 0,null,function*(){try{b(!0);const{data:s,error:i}=yield j.from("lab_tests").select("*").or(`organization_id.is.null,organization_id.eq.${t.id}`).order("name");if(i)throw i;l(s||[])}catch(s){console.error("Error loading tests:",s),c.error("Failed to load lab tests")}finally{b(!1)}}),C=s=>g(void 0,null,function*(){if(s.preventDefault(),!a.name.trim()){c.error("Test name is required");return}try{const i={name:a.name.trim(),code:a.code.trim()||null,description:a.description.trim()||null,default_price:a.default_price||0,is_active:a.is_active,organization_id:t.id};if(o){const{error:h}=yield j.from("lab_tests").update(i).eq("id",o.id);if(h)throw h;c.success("Lab test updated successfully")}else{const{error:h}=yield j.from("lab_tests").insert([i]);if(h)throw h;c.success("Lab test created successfully")}x(!1),n(null),d({name:"",code:"",description:"",default_price:0,is_active:!0}),y()}catch(i){console.error("Error saving test:",i),c.error(i.message||"Failed to save lab test")}}),k=s=>{if(s.organization_id===null){c.error("Cannot edit global lab tests");return}n(s),d({name:s.name,code:s.code||"",description:s.description||"",default_price:s.default_price||0,is_active:s.is_active}),x(!0)},T=s=>g(void 0,null,function*(){if(s.organization_id===null){c.error("Cannot delete global lab tests");return}if(confirm(`Are you sure you want to delete "${s.name}"?`))try{const{error:i}=yield j.from("lab_tests").delete().eq("id",s.id);if(i)throw i;c.success("Lab test deleted successfully"),y()}catch(i){console.error("Error deleting test:",i),c.error(i.message||"Failed to delete lab test")}}),S=()=>{x(!1),n(null),d({name:"",code:"",description:"",default_price:0,is_active:!0})};return N?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400",children:"Loading lab tests..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Lab Tests"}),e.jsx("p",{className:"text-slate-400",children:"Manage available laboratory tests for your organization"})]}),!f&&e.jsxs("button",{onClick:()=>x(!0),className:"inline-flex items-center px-4 py-2 bg-primary hover:bg-opacity-80 text-white rounded-lg transition-colors font-medium",children:[e.jsx(q,{className:"w-5 h-5 mr-2"}),"Add Lab Test"]})]}),f&&e.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:o?"Edit Lab Test":"New Lab Test"}),e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:["Test Name ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("input",{type:"text",value:a.name,onChange:s=>d(u(m({},a),{name:s.target.value})),placeholder:"e.g., Complete Blood Count",className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Test Code"}),e.jsx("input",{type:"text",value:a.code,onChange:s=>d(u(m({},a),{code:s.target.value})),placeholder:"e.g., CBC",className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Description"}),e.jsx("textarea",{value:a.description,onChange:s=>d(u(m({},a),{description:s.target.value})),rows:3,placeholder:"Enter test description...",className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary resize-none"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Default Price"}),e.jsx("input",{type:"number",value:a.default_price,onChange:s=>d(u(m({},a),{default_price:parseFloat(s.target.value)||0})),min:"0",step:"0.01",className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Status"}),e.jsxs("select",{value:a.is_active?"active":"inactive",onChange:s=>d(u(m({},a),{is_active:s.target.value==="active"})),className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary",children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4",children:[e.jsxs("button",{type:"button",onClick:S,className:"inline-flex items-center px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors",children:[e.jsx($,{className:"w-4 h-4 mr-2"}),"Cancel"]}),e.jsxs("button",{type:"submit",className:"inline-flex items-center px-4 py-2 bg-primary hover:bg-opacity-80 text-white rounded-lg transition-colors",children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),o?"Update Test":"Create Test"]})]})]})]}),e.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-lg overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-900 border-b border-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-300 uppercase tracking-wider",children:"Test Name"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-300 uppercase tracking-wider",children:"Code"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-300 uppercase tracking-wider",children:"Description"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-300 uppercase tracking-wider",children:"Price"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-300 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-300 uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-6 py-4 text-right text-xs font-semibold text-slate-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-700",children:r.map(s=>e.jsxs("tr",{className:"hover:bg-slate-750 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(_,{className:"w-5 h-5 text-purple-400"}),e.jsx("span",{className:"text-sm font-medium text-white",children:s.name})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-slate-300",children:s.code||e.jsx("span",{className:"text-slate-500",children:"-"})})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-slate-300",children:s.description?s.description.length>60?e.jsxs("span",{title:s.description,children:[s.description.substring(0,60),"..."]}):s.description:e.jsx("span",{className:"text-slate-500",children:"-"})})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-slate-300",children:s.default_price?`$${s.default_price.toFixed(2)}`:"-"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded border ${s.is_active?"bg-green-900 text-green-300 border-green-700":"bg-slate-700 text-slate-400 border-slate-600"}`,children:s.is_active?"Active":"Inactive"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded border ${s.organization_id===null?"bg-blue-900 text-blue-300 border-blue-700":"bg-amber-900 text-amber-300 border-amber-700"}`,children:s.organization_id===null?"Global":"Custom"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[s.organization_id!==null&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>k(s),className:"p-2 text-blue-300 bg-blue-900 hover:bg-blue-800 border border-blue-700 rounded-lg transition-colors",children:e.jsx(I,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>T(s),className:"p-2 text-red-300 bg-red-900 hover:bg-red-800 border border-red-700 rounded-lg transition-colors",children:e.jsx(B,{className:"w-4 h-4"})})]}),s.organization_id===null&&e.jsx("span",{className:"text-xs text-slate-500 italic",children:"Global test"})]})})]},s.id))})]})}),r.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(_,{className:"w-16 h-16 text-slate-600 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400 mb-2",children:"No lab tests available"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Add your first lab test to get started"})]})]})]})};export{U as LabTests};
