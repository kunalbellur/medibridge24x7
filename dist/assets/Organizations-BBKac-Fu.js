var T=Object.defineProperty,G=Object.defineProperties;var M=Object.getOwnPropertyDescriptors;var O=Object.getOwnPropertySymbols;var J=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable;var E=(c,r,l)=>r in c?T(c,r,{enumerable:!0,configurable:!0,writable:!0,value:l}):c[r]=l,S=(c,r)=>{for(var l in r||(r={}))J.call(r,l)&&E(c,l,r[l]);if(O)for(var l of O(r))R.call(r,l)&&E(c,l,r[l]);return c},C=(c,r)=>G(c,M(r));var j=(c,r,l)=>new Promise((m,o)=>{var x=t=>{try{g(l.next(t))}catch(b){o(b)}},d=t=>{try{g(l.throw(t))}catch(b){o(b)}},g=t=>t.done?m(t.value):Promise.resolve(t.value).then(x,d);g((l=l.apply(c,r)).next())});import{j as e,I as w,B as z,s as f}from"./index-cCeCS7Tx.js";import{r as p}from"./react-vendor-DnMe622U.js";import{X as V,z as _,x as B,y as $,E as H,J as W}from"./ui-vendor-B7h9uWP1.js";import{F as X}from"./FileUpload-BOWKzXUD.js";import{D as K}from"./DeleteConfirmationDialog-Cqj31qox.js";import"./supabase-vendor-BUL0ZXqy.js";const Q=({isOpen:c,onClose:r,onSubmit:l,organization:m,settings:o,mode:x})=>{const[d,g]=p.useState(!1),[t,b]=p.useState({name:"",subdomain:"",logo_url:"",status:"active",primary_color:"#3B82F6",secondary_color:"#10B981",ai_enabled:!0,escalation_enabled:!0});p.useEffect(()=>{var s,h;x==="edit"&&m?b({name:m.name,subdomain:m.subdomain,logo_url:m.logo_url||"",status:m.status,primary_color:(o==null?void 0:o.primary_color)||"#3B82F6",secondary_color:(o==null?void 0:o.secondary_color)||"#10B981",ai_enabled:(s=o==null?void 0:o.ai_enabled)!=null?s:!0,escalation_enabled:(h=o==null?void 0:o.escalation_enabled)!=null?h:!0}):x==="create"&&b({name:"",subdomain:"",logo_url:"",status:"active",primary_color:"#3B82F6",secondary_color:"#10B981",ai_enabled:!0,escalation_enabled:!0})},[x,m,o]);const u=s=>j(void 0,null,function*(){s.preventDefault(),g(!0);try{yield l(t),r()}catch(h){console.error("Form submit error:",h)}finally{g(!1)}}),i=(s,h)=>{b(v=>C(S({},v),{[s]:h}))};return c?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-slate-800 rounded-lg shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto border border-slate-700",children:[e.jsxs("div",{className:"sticky top-0 bg-slate-800 border-b border-slate-700 px-6 py-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold text-white",children:x==="create"?"Add New Organization":"Edit Organization"}),e.jsx("button",{onClick:r,className:"text-slate-400 hover:text-white transition-colors",disabled:d,children:e.jsx(V,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:u,className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-300 uppercase tracking-wide",children:"Organization Details"}),e.jsx(w,{label:"Organization Name",placeholder:"City General Hospital",value:t.name,onChange:s=>i("name",s.target.value),required:!0,disabled:d}),e.jsx(w,{label:"Subdomain",placeholder:"city-general",value:t.subdomain,onChange:s=>i("subdomain",s.target.value.toLowerCase().replace(/\s+/g,"-")),required:!0,disabled:d,helperText:"Used for organization identification (lowercase, hyphens allowed)"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Organization Logo"}),t.logo_url&&e.jsxs("div",{className:"mb-4 p-4 bg-slate-900 border border-slate-700 rounded-lg",children:[e.jsx("img",{src:t.logo_url,alt:"Current logo",className:"h-16 w-auto object-contain"}),e.jsx("p",{className:"text-xs text-slate-500 mt-2",children:"Current logo"})]}),x==="edit"&&m&&e.jsx(X,{bucket:"org-logos",folder:m.id,onUploadComplete:s=>i("logo_url",s),acceptedFileTypes:"image/*",maxSizeMB:2,label:"Upload New Logo",description:"PNG, JPG, or SVG"}),x==="create"&&e.jsx(w,{label:"Logo URL (optional)",placeholder:"https://example.com/logo.png",value:t.logo_url,onChange:s=>i("logo_url",s.target.value),disabled:d,helperText:"Upload logo after creating organization"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Status"}),e.jsxs("select",{value:t.status,onChange:s=>i("status",s.target.value),className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent",disabled:d,children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"}),e.jsx("option",{value:"suspended",children:"Suspended"})]})]})]}),e.jsxs("div",{className:"border-t border-slate-700 pt-6 space-y-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-300 uppercase tracking-wide",children:"Organization Settings"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(w,{label:"Primary Color",type:"color",value:t.primary_color,onChange:s=>i("primary_color",s.target.value),disabled:d}),e.jsx(w,{label:"Secondary Color",type:"color",value:t.secondary_color,onChange:s=>i("secondary_color",s.target.value),disabled:d})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.ai_enabled,onChange:s=>i("ai_enabled",s.target.checked),className:"w-5 h-5 text-primary-600 bg-slate-900 border-slate-700 rounded focus:ring-primary-500 focus:ring-offset-slate-800",disabled:d}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-white",children:"AI Features Enabled"}),e.jsx("p",{className:"text-xs text-slate-400",children:"Enable AI-powered diagnostics and automation"})]})]}),e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.escalation_enabled,onChange:s=>i("escalation_enabled",s.target.checked),className:"w-5 h-5 text-primary-600 bg-slate-900 border-slate-700 rounded focus:ring-primary-500 focus:ring-offset-slate-800",disabled:d}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-white",children:"Escalation System Enabled"}),e.jsx("p",{className:"text-xs text-slate-400",children:"Allow staff to escalate complex cases"})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-6 border-t border-slate-700",children:[e.jsx(z,{type:"button",variant:"outline",onClick:r,disabled:d,children:"Cancel"}),e.jsx(z,{type:"submit",isLoading:d,disabled:d,children:x==="create"?"Create Organization":"Update Organization"})]})]})]})}):null},re=()=>{const[c,r]=p.useState([]),[l,m]=p.useState(!0),[o,x]=p.useState(!1),[d,g]=p.useState(!1),[t,b]=p.useState("create"),[u,i]=p.useState(null),[s,h]=p.useState(!1);p.useEffect(()=>{v()},[]);const v=()=>j(void 0,null,function*(){try{m(!0);const{data:a,error:n}=yield f.from("organizations").select("*").order("created_at",{ascending:!1});if(n)throw n;const y=yield Promise.all((a||[]).map(N=>j(void 0,null,function*(){const{data:P}=yield f.from("organization_settings").select("*").eq("organization_id",N.id).maybeSingle();return C(S({},N),{settings:P||void 0})})));r(y)}catch(a){console.error("Error loading organizations:",a),_.error(a.message||"Failed to load organizations")}finally{m(!1)}}),L=a=>j(void 0,null,function*(){try{h(!0);const{data:n,error:y}=yield f.from("organizations").insert({name:a.name,subdomain:a.subdomain,logo_url:a.logo_url||null,status:a.status}).select().single();if(y)throw y;const{error:N}=yield f.from("organization_settings").insert({organization_id:n.id,primary_color:a.primary_color||"#3B82F6",secondary_color:a.secondary_color||"#10B981",logo_url:a.logo_url||null,ai_enabled:a.ai_enabled,escalation_enabled:a.escalation_enabled});if(N)throw N;_.success("Organization created successfully"),v(),x(!1)}catch(n){throw console.error("Error creating organization:",n),_.error(n.message||"Failed to create organization"),n}finally{h(!1)}}),A=a=>j(void 0,null,function*(){if(u)try{h(!0);const{error:n}=yield f.from("organizations").update({name:a.name,subdomain:a.subdomain,logo_url:a.logo_url||null,status:a.status}).eq("id",u.id);if(n)throw n;if(u.settings){const{error:y}=yield f.from("organization_settings").update({primary_color:a.primary_color||"#3B82F6",secondary_color:a.secondary_color||"#10B981",logo_url:a.logo_url||null,ai_enabled:a.ai_enabled,escalation_enabled:a.escalation_enabled}).eq("id",u.settings.id);if(y)throw y}else{const{error:y}=yield f.from("organization_settings").insert({organization_id:u.id,primary_color:a.primary_color||"#3B82F6",secondary_color:a.secondary_color||"#10B981",logo_url:a.logo_url||null,ai_enabled:a.ai_enabled,escalation_enabled:a.escalation_enabled});if(y)throw y}_.success("Organization updated successfully"),v(),x(!1),i(null)}catch(n){throw console.error("Error updating organization:",n),_.error(n.message||"Failed to update organization"),n}finally{h(!1)}}),I=()=>j(void 0,null,function*(){if(u)try{h(!0);const{error:a}=yield f.from("organizations").update({status:"inactive"}).eq("id",u.id);if(a)throw a;_.success("Organization deactivated successfully"),v(),g(!1),i(null)}catch(a){throw console.error("Error deactivating organization:",a),_.error(a.message||"Failed to deactivate organization"),a}finally{h(!1)}}),k=()=>{i(null),b("create"),x(!0)},F=a=>{i(a),b("edit"),x(!0)},U=a=>{i(a),g(!0)},q=a=>{const n={active:"bg-secondary-900 text-secondary-300 border-secondary-700",inactive:"bg-slate-700 text-slate-300 border-slate-600",suspended:"bg-accent-900 text-accent-300 border-accent-700"};return e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded border ${n[a]||n.inactive}`,children:a.charAt(0).toUpperCase()+a.slice(1)})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Organizations"}),e.jsx("p",{className:"text-slate-400",children:"Manage healthcare organizations in the system"})]}),e.jsxs(z,{onClick:k,children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Add Organization"]})]}),l?e.jsx("div",{className:"bg-slate-800 border border-slate-700 rounded-lg p-12 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-500 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400",children:"Loading organizations..."})]})}):c.length===0?e.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-lg p-12 text-center",children:[e.jsx("p",{className:"text-slate-400 mb-4",children:"No organizations found"}),e.jsxs(z,{onClick:k,children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Create First Organization"]})]}):e.jsx("div",{className:"bg-slate-800 border border-slate-700 rounded-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-900 border-b border-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-300 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-300 uppercase tracking-wider",children:"Subdomain"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-300 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-300 uppercase tracking-wider",children:"Created"}),e.jsx("th",{className:"px-6 py-4 text-right text-xs font-semibold text-slate-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-700",children:c.map(a=>e.jsxs("tr",{className:"hover:bg-slate-750 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[a.logo_url?e.jsx("img",{src:a.logo_url,alt:a.name,className:"w-10 h-10 rounded-lg object-cover"}):e.jsx("div",{className:"w-10 h-10 bg-primary-600 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-white font-semibold text-sm",children:a.name.charAt(0)})}),e.jsx("span",{className:"text-sm font-medium text-white",children:a.name})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-slate-300",children:a.subdomain})}),e.jsx("td",{className:"px-6 py-4",children:q(a.status)}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-slate-300",children:new Date(a.created_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsx("button",{onClick:()=>F(a),className:"p-2 text-slate-400 hover:text-primary-400 hover:bg-slate-700 rounded transition-colors",title:"Edit",children:e.jsx($,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>F(a),className:"p-2 text-slate-400 hover:text-secondary-400 hover:bg-slate-700 rounded transition-colors",title:"View Settings",children:e.jsx(H,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>U(a),className:"p-2 text-slate-400 hover:text-accent-400 hover:bg-slate-700 rounded transition-colors",title:"Deactivate",children:e.jsx(W,{className:"w-4 h-4"})})]})})]},a.id))})]})})}),e.jsx(Q,{isOpen:o,onClose:()=>{x(!1),i(null)},onSubmit:t==="create"?L:A,organization:u||void 0,settings:u==null?void 0:u.settings,mode:t}),e.jsx(K,{isOpen:d,onClose:()=>{g(!1),i(null)},onConfirm:I,title:"Deactivate Organization",message:`Are you sure you want to deactivate "${u==null?void 0:u.name}"? This will set the status to inactive and prevent users from accessing this organization.`,isLoading:s})]})};export{re as Organizations};
