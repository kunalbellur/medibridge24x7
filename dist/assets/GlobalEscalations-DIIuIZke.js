var $=Object.defineProperty,G=Object.defineProperties;var T=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var H=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var q=(l,r,a)=>r in l?$(l,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):l[r]=a,j=(l,r)=>{for(var a in r||(r={}))H.call(r,a)&&q(l,a,r[a]);if(M)for(var a of M(r))W.call(r,a)&&q(l,a,r[a]);return l},N=(l,r)=>G(l,T(r));var w=(l,r,a)=>new Promise((p,d)=>{var u=n=>{try{c(a.next(n))}catch(x){d(x)}},g=n=>{try{c(a.throw(n))}catch(x){d(x)}},c=n=>n.done?p(n.value):Promise.resolve(n.value).then(u,g);c((a=a.apply(l,r)).next())});import{s as m,j as e}from"./index-wYB_OSb7.js";import{r as o}from"./react-vendor-BcqdGgAs.js";import{z as O,X,h as v,g as J,u as K,v as Q,n as Y}from"./ui-vendor-BPow5NNe.js";import"./supabase-vendor-DqPCCbyy.js";const Z=({isOpen:l,onClose:r,chatSessionId:a,patientName:p})=>{const[d,u]=o.useState([]),[g,c]=o.useState(!0);o.useEffect(()=>{l&&a&&n()},[l,a]);const n=()=>w(void 0,null,function*(){try{c(!0);const{data:t,error:h}=yield m.from("messages").select("*").eq("chat_session_id",a).order("sent_at",{ascending:!0});if(h)throw h;u(t||[])}catch(t){console.error("Error loading messages:",t),O.error("Failed to load chat messages")}finally{c(!1)}}),x=t=>{switch(t){case"patient":return e.jsx(Q,{className:"w-4 h-4"});case"bot":return e.jsx(K,{className:"w-4 h-4"});case"doctor":return e.jsx(J,{className:"w-4 h-4"});case"human":return e.jsx(v,{className:"w-4 h-4"});default:return e.jsx(v,{className:"w-4 h-4"})}},b=t=>{switch(t){case"patient":return"bg-blue-900 border-blue-700 text-blue-300";case"bot":return"bg-purple-900 border-purple-700 text-purple-300";case"doctor":return"bg-green-900 border-green-700 text-green-300";case"human":return"bg-amber-900 border-amber-700 text-amber-300";default:return"bg-slate-700 border-slate-600 text-slate-300"}},y=t=>t.charAt(0).toUpperCase()+t.slice(1);return l?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-slate-800 rounded-lg shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col border border-slate-700",children:[e.jsxs("div",{className:"bg-slate-900 border-b border-slate-700 px-6 py-4 flex items-center justify-between rounded-t-lg",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-white",children:"Chat Session"}),e.jsxs("p",{className:"text-sm text-slate-400 mt-1",children:["Patient: ",p]})]}),e.jsx("button",{onClick:r,className:"text-slate-400 hover:text-white transition-colors",children:e.jsx(X,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6 space-y-4",children:g?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-500 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400",children:"Loading messages..."})]})}):d.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(v,{className:"w-16 h-16 text-slate-600 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400",children:"No messages in this chat session"})]}):d.map(t=>e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:`flex-shrink-0 w-10 h-10 rounded-full border-2 flex items-center justify-center ${b(t.sender_type)}`,children:x(t.sender_type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-baseline space-x-2 mb-1",children:[e.jsx("span",{className:"text-sm font-semibold text-white",children:y(t.sender_type)}),e.jsx("span",{className:"text-xs text-slate-500",children:new Date(t.sent_at).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),e.jsx("div",{className:"bg-slate-900 rounded-lg px-4 py-3 border border-slate-700",children:e.jsx("p",{className:"text-sm text-slate-300 whitespace-pre-wrap",children:t.content})})]})]},t.id))}),e.jsx("div",{className:"bg-slate-900 border-t border-slate-700 px-6 py-4 rounded-b-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-slate-400",children:[d.length," message",d.length!==1?"s":""," in this conversation"]}),e.jsx("button",{onClick:r,className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors",children:"Close"})]})})]})}):null},ie=()=>{const[l,r]=o.useState([]),[a,p]=o.useState([]),[d,u]=o.useState([]),[g,c]=o.useState(!0),[n,x]=o.useState(!1),[b,y]=o.useState(null),[t,h]=o.useState({organization:"",priority:"",status:""});o.useEffect(()=>{D()},[]),o.useEffect(()=>{I()},[l,t]);const D=()=>w(void 0,null,function*(){try{c(!0);const[s,i]=yield Promise.all([m.from("organizations").select("id, name").order("name"),m.from("escalations").select("*").order("created_at",{ascending:!1})]);if(s.error)throw s.error;if(i.error)throw i.error;u(s.data||[]);const _=yield Promise.all((i.data||[]).map(f=>w(void 0,null,function*(){var P,E,U,L,A;const[z,V]=yield Promise.all([m.from("chat_sessions").select("patient_id, organization_id").eq("id",f.chat_session_id).maybeSingle(),m.from("organizations").select("name").eq("id",f.organization_id).maybeSingle()]);let C="Unknown Patient";(P=z.data)!=null&&P.patient_id&&(C=((E=(yield m.from("patients").select("full_name").eq("id",z.data.patient_id).maybeSingle()).data)==null?void 0:E.full_name)||"Unknown Patient");let k;if(f.assigned_to){const S=yield m.from("org_staff").select("user_id").eq("id",f.assigned_to).maybeSingle();(U=S.data)!=null&&U.user_id&&(k=(L=(yield m.from("auth.users").select("email").eq("id",S.data.user_id).maybeSingle()).data)==null?void 0:L.email)}return N(j({},f),{org_name:((A=V.data)==null?void 0:A.name)||"Unknown Organization",patient_name:C,assigned_name:k})})));r(_)}catch(s){console.error("Error loading escalations:",s),O.error(s.message||"Failed to load escalations")}finally{c(!1)}}),I=()=>{let s=l;t.organization&&(s=s.filter(i=>i.organization_id===t.organization)),t.priority&&(s=s.filter(i=>i.priority===t.priority)),t.status&&(s=s.filter(i=>i.status===t.status)),p(s)},R=(s,i)=>{y({id:s,patientName:i}),x(!0)},F=s=>{const i={low:"bg-blue-900 text-blue-300 border-blue-700",medium:"bg-amber-900 text-amber-300 border-amber-700",high:"bg-red-900 text-red-300 border-red-700"};return e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded border ${i[s]||i.medium}`,children:s.charAt(0).toUpperCase()+s.slice(1)})},B=s=>{const i={pending:"bg-slate-700 text-slate-300 border-slate-600",in_progress:"bg-primary-900 text-primary-300 border-primary-700",resolved:"bg-secondary-900 text-secondary-300 border-secondary-700"},_={pending:"Pending",in_progress:"In Progress",resolved:"Resolved"};return e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded border ${i[s]||i.pending}`,children:_[s]||s})};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Global Escalations"}),e.jsx("p",{className:"text-slate-400",children:"Monitor and manage escalated cases across all organizations"})]})}),e.jsx("div",{className:"bg-slate-800 border border-slate-700 rounded-lg p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Organization"}),e.jsxs("select",{value:t.organization,onChange:s=>h(N(j({},t),{organization:s.target.value})),className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:[e.jsx("option",{value:"",children:"All Organizations"}),d.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Priority"}),e.jsxs("select",{value:t.priority,onChange:s=>h(N(j({},t),{priority:s.target.value})),className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:[e.jsx("option",{value:"",children:"All Priorities"}),e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Status"}),e.jsxs("select",{value:t.status,onChange:s=>h(N(j({},t),{status:s.target.value})),className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"resolved",children:"Resolved"})]})]})]})}),g?e.jsx("div",{className:"bg-slate-800 border border-slate-700 rounded-lg p-12 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-500 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400",children:"Loading escalations..."})]})}):a.length===0?e.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-lg p-12 text-center",children:[e.jsx(Y,{className:"w-16 h-16 text-slate-600 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400 mb-2",children:Object.values(t).some(s=>s)?"No escalations match your filters":"No escalations found"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Escalated cases will appear here when they need attention"})]}):e.jsx("div",{className:"bg-slate-800 border border-slate-700 rounded-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-900 border-b border-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-300 uppercase tracking-wider",children:"Organization"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-300 uppercase tracking-wider",children:"Patient"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-300 uppercase tracking-wider",children:"Priority"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-300 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-300 uppercase tracking-wider",children:"Assigned To"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-300 uppercase tracking-wider",children:"Created"}),e.jsx("th",{className:"px-6 py-4 text-right text-xs font-semibold text-slate-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-700",children:a.map(s=>e.jsxs("tr",{className:"hover:bg-slate-750 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm font-medium text-white",children:s.org_name})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-slate-300",children:s.patient_name})}),e.jsx("td",{className:"px-6 py-4",children:F(s.priority)}),e.jsx("td",{className:"px-6 py-4",children:B(s.status)}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-slate-300",children:s.assigned_name||e.jsx("span",{className:"text-slate-500 italic",children:"Unassigned"})})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-slate-300",children:new Date(s.created_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"flex items-center justify-end",children:e.jsxs("button",{onClick:()=>R(s.chat_session_id,s.patient_name),className:"inline-flex items-center px-3 py-1.5 text-sm font-medium text-primary-300 bg-primary-900 hover:bg-primary-800 border border-primary-700 rounded-lg transition-colors",children:[e.jsx(v,{className:"w-4 h-4 mr-2"}),"View Chat"]})})})]},s.id))})]})})}),n&&b&&e.jsx(Z,{isOpen:n,onClose:()=>{x(!1),y(null)},chatSessionId:b.id,patientName:b.patientName})]})};export{ie as GlobalEscalations};
