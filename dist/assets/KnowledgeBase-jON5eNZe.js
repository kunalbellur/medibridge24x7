var X=Object.defineProperty,$=Object.defineProperties;var J=Object.getOwnPropertyDescriptors;var O=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var D=(o,r,l)=>r in o?X(o,r,{enumerable:!0,configurable:!0,writable:!0,value:l}):o[r]=l,k=(o,r)=>{for(var l in r||(r={}))Y.call(r,l)&&D(o,l,r[l]);if(O)for(var l of O(r))Z.call(r,l)&&D(o,l,r[l]);return o},F=(o,r)=>$(o,J(r));var w=(o,r,l)=>new Promise((g,p)=>{var c=b=>{try{h(l.next(b))}catch(n){p(n)}},C=b=>{try{h(l.throw(b))}catch(n){p(n)}},h=b=>b.done?g(b.value):Promise.resolve(b.value).then(c,C);h((l=l.apply(o,r)).next())});import{s as _,j as e,I as L,B as E}from"./index-wYB_OSb7.js";import{r as i}from"./react-vendor-BcqdGgAs.js";import{X as ee,z as N,P as T,t as te,G as se,i as ae,q as re,s as le}from"./ui-vendor-BPow5NNe.js";import{D as ie}from"./DeleteConfirmationDialog-B_RDDzPQ.js";import"./supabase-vendor-DqPCCbyy.js";const oe=({isOpen:o,onClose:r,onSubmit:l,article:g,mode:p})=>{const[c,C]=i.useState(!1),[h,b]=i.useState([]),[n,S]=i.useState({title:"",content:"",category:"",tags:[],is_global:!1,organization_id:void 0}),[z,m]=i.useState("");i.useEffect(()=>{o&&j()},[o]),i.useEffect(()=>{p==="edit"&&g?(S({title:g.title,content:g.content,category:g.category||"",tags:g.tags||[],is_global:g.is_global,organization_id:g.organization_id}),m((g.tags||[]).join(", "))):p==="create"&&(S({title:"",content:"",category:"",tags:[],is_global:!1,organization_id:void 0}),m(""))},[p,g]);const j=()=>w(void 0,null,function*(){try{const{data:s,error:f}=yield _.from("organizations").select("*").order("name");if(f)throw f;b(s||[])}catch(s){console.error("Error loading organizations:",s)}}),q=s=>w(void 0,null,function*(){s.preventDefault(),C(!0);try{const f=z.split(",").map(x=>x.trim()).filter(x=>x.length>0);yield l(F(k({},n),{tags:f,organization_id:n.is_global?void 0:n.organization_id})),r()}catch(f){console.error("Form submit error:",f)}finally{C(!1)}}),u=(s,f)=>{S(x=>F(k({},x),{[s]:f}))};return o?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-slate-800 rounded-lg shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-y-auto border border-slate-700",children:[e.jsxs("div",{className:"sticky top-0 bg-slate-800 border-b border-slate-700 px-6 py-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold text-white",children:p==="create"?"Add New Article":"Edit Article"}),e.jsx("button",{onClick:r,className:"text-slate-400 hover:text-white transition-colors",disabled:c,children:e.jsx(ee,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:q,className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(L,{label:"Article Title",placeholder:"How to manage diabetes effectively",value:n.title,onChange:s=>u("title",s.target.value),required:!0,disabled:c,className:"bg-slate"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Content"}),e.jsx("textarea",{value:n.content,onChange:s=>u("content",s.target.value),placeholder:"Enter the full article content...",required:!0,disabled:c,rows:12,className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 text-white placeholder-slate-500 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 resize-none"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(L,{label:"Category",placeholder:"General Health, Nutrition, etc.",value:n.category,onChange:s=>u("category",s.target.value),disabled:c,className:"bg-slate"}),e.jsx(L,{label:"Tags (comma-separated)",placeholder:"diabetes, diet, exercise",value:z,onChange:s=>m(s.target.value),disabled:c,className:"bg-slate",helperText:"Separate tags with commas"})]})]}),e.jsxs("div",{className:"border-t border-slate-700 pt-6 space-y-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-300 uppercase tracking-wide",children:"Visibility Settings"}),e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:n.is_global,onChange:s=>{u("is_global",s.target.checked),s.target.checked&&u("organization_id",void 0)},className:"w-5 h-5 text-primary-600 bg-slate-900 border-slate-700 rounded focus:ring-primary-500 focus:ring-offset-slate-800",disabled:c}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-white",children:"Global Article"}),e.jsx("p",{className:"text-xs text-slate-400",children:"Make this article visible to all organizations"})]})]}),!n.is_global&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Organization"}),e.jsxs("select",{value:n.organization_id||"",onChange:s=>u("organization_id",s.target.value||void 0),className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent",disabled:c,required:!n.is_global,children:[e.jsx("option",{value:"",children:"Select an organization..."}),h.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsx("p",{className:"mt-1 text-xs text-slate-400",children:"This article will only be visible to the selected organization"})]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-6 border-t border-slate-700",children:[e.jsx(E,{type:"button",variant:"outline",onClick:r,disabled:c,children:"Cancel"}),e.jsx(E,{type:"submit",isLoading:c,disabled:c,children:p==="create"?"Create Article":"Update Article"})]})]})]})}):null},xe=()=>{const[o,r]=i.useState([]),[l,g]=i.useState([]),[p,c]=i.useState(!0),[C,h]=i.useState(!1),[b,n]=i.useState(!1),[S,z]=i.useState("create"),[m,j]=i.useState(null),[q,u]=i.useState(!1),[s,f]=i.useState(""),[x,B]=i.useState(""),[G,M]=i.useState([]);i.useEffect(()=>{A()},[]),i.useEffect(()=>{P()},[o,s,x]);const A=()=>w(void 0,null,function*(){try{c(!0);const{data:t,error:a}=yield _.from("knowledge_articles").select("*").order("created_at",{ascending:!1});if(a)throw a;const d=yield Promise.all((t||[]).map(y=>w(void 0,null,function*(){if(y.organization_id){const{data:W}=yield _.from("organizations").select("name").eq("id",y.organization_id).maybeSingle();return F(k({},y),{organization:W||void 0})}return y})));r(d);const v=Array.from(new Set(d.map(y=>y.category).filter(y=>!!y)));M(v)}catch(t){console.error("Error loading articles:",t),N.error(t.message||"Failed to load articles")}finally{c(!1)}}),P=()=>{let t=o;if(s){const a=s.toLowerCase();t=t.filter(d=>{var v;return d.title.toLowerCase().includes(a)||d.content.toLowerCase().includes(a)||((v=d.tags)==null?void 0:v.some(y=>y.toLowerCase().includes(a)))})}x&&(t=t.filter(a=>a.category===x)),g(t)},U=t=>w(void 0,null,function*(){var a;try{u(!0);const{data:d}=yield _.auth.getUser(),{error:v}=yield _.from("knowledge_articles").insert({title:t.title,content:t.content,category:t.category||null,tags:t.tags,is_global:t.is_global,organization_id:t.organization_id||null,created_by:(a=d.user)==null?void 0:a.id});if(v)throw v;N.success("Article created successfully"),A(),h(!1)}catch(d){throw console.error("Error creating article:",d),N.error(d.message||"Failed to create article"),d}finally{u(!1)}}),H=t=>w(void 0,null,function*(){if(m)try{u(!0);const{error:a}=yield _.from("knowledge_articles").update({title:t.title,content:t.content,category:t.category||null,tags:t.tags,is_global:t.is_global,organization_id:t.organization_id||null}).eq("id",m.id);if(a)throw a;N.success("Article updated successfully"),A(),h(!1),j(null)}catch(a){throw console.error("Error updating article:",a),N.error(a.message||"Failed to update article"),a}finally{u(!1)}}),K=()=>w(void 0,null,function*(){if(m)try{u(!0);const{error:t}=yield _.from("knowledge_articles").delete().eq("id",m.id);if(t)throw t;N.success("Article deleted successfully"),A(),n(!1),j(null)}catch(t){throw console.error("Error deleting article:",t),N.error(t.message||"Failed to delete article"),t}finally{u(!1)}}),I=()=>{j(null),z("create"),h(!0)},Q=t=>{j(t),z("edit"),h(!0)},R=t=>{j(t),n(!0)},V=(t,a=150)=>t.length<=a?t:t.substring(0,a)+"...";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Knowledge Base"}),e.jsx("p",{className:"text-slate-400",children:"Manage healthcare articles and information resources"})]}),e.jsxs(E,{onClick:I,children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"Add Article"]})]}),e.jsx("div",{className:"bg-slate-800 border border-slate-700 rounded-lg p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(te,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Search articles by title, content, or tags...",value:s,onChange:t=>f(t.target.value),className:"w-full pl-10 pr-4 py-2 bg-slate-900 border border-slate-700 text-white placeholder-slate-500 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"})]})}),e.jsx("div",{children:e.jsxs("select",{value:x,onChange:t=>B(t.target.value),className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:[e.jsx("option",{value:"",children:"All Categories"}),G.map(t=>e.jsx("option",{value:t,children:t},t))]})})]})}),p?e.jsx("div",{className:"bg-slate-800 border border-slate-700 rounded-lg p-12 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-500 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400",children:"Loading articles..."})]})}):l.length===0?e.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-lg p-12 text-center",children:[e.jsx("p",{className:"text-slate-400 mb-4",children:s||x?"No articles match your filters":"No articles found"}),!s&&!x&&e.jsxs(E,{onClick:I,children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"Create First Article"]})]}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:l.map(t=>{var a;return e.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-lg p-6 hover:border-slate-600 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[t.is_global?e.jsx(se,{className:"w-4 h-4 text-primary-400"}):e.jsx(ae,{className:"w-4 h-4 text-secondary-400"}),e.jsx("span",{className:"text-xs text-slate-400",children:t.is_global?"Global Article":((a=t.organization)==null?void 0:a.name)||"Organization Specific"})]}),e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:t.title}),t.category&&e.jsx("span",{className:"inline-block px-2 py-1 bg-primary-900 text-primary-300 text-xs font-medium rounded border border-primary-700 mb-2",children:t.category})]}),e.jsxs("div",{className:"flex items-center space-x-2 ml-4",children:[e.jsx("button",{onClick:()=>Q(t),className:"p-2 text-slate-400 hover:text-primary-400 hover:bg-slate-700 rounded transition-colors",title:"Edit",children:e.jsx(re,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>R(t),className:"p-2 text-slate-400 hover:text-accent-400 hover:bg-slate-700 rounded transition-colors",title:"Delete",children:e.jsx(le,{className:"w-4 h-4"})})]})]}),e.jsx("p",{className:"text-sm text-slate-300 mb-4",children:V(t.content)}),t.tags&&t.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:t.tags.map((d,v)=>e.jsx("span",{className:"px-2 py-1 bg-slate-700 text-slate-300 text-xs rounded",children:d},v))}),e.jsx("div",{className:"text-xs text-slate-500",children:new Date(t.created_at).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})})]},t.id)})}),e.jsx(oe,{isOpen:C,onClose:()=>{h(!1),j(null)},onSubmit:S==="create"?U:H,article:m||void 0,mode:S}),e.jsx(ie,{isOpen:b,onClose:()=>{n(!1),j(null)},onConfirm:K,title:"Delete Article",message:`Are you sure you want to delete "${m==null?void 0:m.title}"? This action cannot be undone.`,isLoading:q})]})};export{xe as KnowledgeBase};
