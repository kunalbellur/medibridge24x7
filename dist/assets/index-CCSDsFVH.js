var Le=Object.defineProperty,Ee=Object.defineProperties;var Ie=Object.getOwnPropertyDescriptors;var je=Object.getOwnPropertySymbols;var Ue=Object.prototype.hasOwnProperty,Ae=Object.prototype.propertyIsEnumerable;var Ne=(r,i,t)=>i in r?Le(r,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[i]=t,R=(r,i)=>{for(var t in i||(i={}))Ue.call(i,t)&&Ne(r,t,i[t]);if(je)for(var t of je(i))Ae.call(i,t)&&Ne(r,t,i[t]);return r},O=(r,i)=>Ee(r,Ie(i));var L=(r,i,t)=>new Promise((a,g)=>{var I=u=>{try{w(t.next(u))}catch(j){g(j)}},k=u=>{try{w(t.throw(u))}catch(j){g(j)}},w=u=>u.done?a(u.value):Promise.resolve(u.value).then(I,k);w((t=t.apply(r,i)).next())});import{j as e,u as V,s as x,C as Z,I as re}from"./index-wYB_OSb7.js";import{L as Bs,a as zs}from"./index-wYB_OSb7.js";import{AdminDashboard as Vs}from"./AdminDashboard-f8ofYQi7.js";import{u as G,r as n,f as ye,h as ne,i as he,d as Fe,e as W}from"./react-vendor-BcqdGgAs.js";import{n as le,R as Me,X as ue,y as Te,U as de,E as H,x as Q,h as me,M as $e,I as pe,J as Re,A as Oe,c as te,T as Be,K as ze,z as q,P as K,t as ve,N as oe,O as be,b as fe,L as We,Q as se,v as X,V as Ve,W as Ge,Y as Qe,F as ee,Z as ie,_ as qe,$ as ge,q as Ke,w as ce,a0 as He,s as Ye,a1 as Je,a2 as Xe,C as De,m as Ze,a3 as xe,u as we,a4 as es,g as ss,a5 as ts}from"./ui-vendor-BPow5NNe.js";import{R as _e,L as as,C as rs,X as ls,Y as is,T as Se,a as ns,b as os,P as cs,c as ds,d as ms}from"./chart-vendor-1PHrxp8_.js";import{F as xs}from"./FileUpload-C83ifAZw.js";import"./supabase-vendor-DqPCCbyy.js";const hs=({rows:r=5,columns:i=5,hasHeader:t=!0})=>e.jsx("div",{className:"bg-slate-800 border border-slate-700 rounded-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[t&&e.jsx("thead",{className:"bg-slate-900 border-b border-slate-700",children:e.jsx("tr",{children:Array.from({length:i}).map((a,g)=>e.jsx("th",{className:"px-6 py-4 text-left",children:e.jsx("div",{className:"animate-pulse",children:e.jsx("div",{className:"h-3 bg-slate-700 rounded w-24"})})},g))})}),e.jsx("tbody",{className:"divide-y divide-slate-700",children:Array.from({length:r}).map((a,g)=>e.jsx("tr",{className:"hover:bg-slate-750",children:Array.from({length:i}).map((I,k)=>e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"animate-pulse",children:k===0?e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-700 rounded-full"}),e.jsx("div",{className:"h-4 bg-slate-700 rounded w-32"})]}):k===i-1?e.jsxs("div",{className:"flex items-center space-x-2 justify-end",children:[e.jsx("div",{className:"h-8 w-20 bg-slate-700 rounded"}),e.jsx("div",{className:"h-8 w-20 bg-slate-700 rounded"})]}):e.jsx("div",{className:"h-4 bg-slate-700 rounded",style:{width:`${Math.random()*40+60}%`}})})},k))},g))})]})})}),us=({icon:r,title:i,description:t,action:a})=>e.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-lg p-12 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-slate-700 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(r,{className:"w-8 h-8 text-slate-500"})}),e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:i}),e.jsx("p",{className:"text-slate-400 mb-6 max-w-md mx-auto",children:t}),a&&e.jsx("button",{onClick:a.onClick,className:"px-6 py-2.5 bg-primary hover:bg-opacity-80 text-white rounded-lg transition-colors font-medium",children:a.label})]}),ps=({title:r="Something went wrong",message:i="An error occurred while loading the data. Please try again.",onRetry:t,fullPage:a=!1})=>{const g=e.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-lg p-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-red-900 bg-opacity-20 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(le,{className:"w-8 h-8 text-red-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:r}),e.jsx("p",{className:"text-slate-400 mb-6 max-w-md mx-auto",children:i}),t&&e.jsxs("button",{onClick:t,className:"inline-flex items-center px-6 py-2.5 bg-primary hover:bg-opacity-80 text-white rounded-lg transition-colors font-medium",children:[e.jsx(Me,{className:"w-4 h-4 mr-2"}),"Try Again"]})]});return a?e.jsx("div",{className:"min-h-screen bg-slate-950 flex items-center justify-center p-4",children:e.jsx("div",{className:"max-w-lg w-full",children:g})}):e.jsx("div",{className:"py-12",children:g})},Ce=[{name:"Dashboard",path:"/portal",icon:Te,exact:!0},{name:"Patients",path:"/portal/patients",icon:de},{name:"Consultations",path:"/portal/consultations",icon:H},{name:"Lab Orders",path:"/portal/lab-orders",icon:Q},{name:"Chat",path:"/portal/chat",icon:me},{name:"Escalations",path:"/portal/escalations",icon:le,badge:!0}],bs=({children:r})=>{var C,T,A;const i=G(),{user:t,organization:a,orgSettings:g,signOut:I}=V(),[k,w]=n.useState(!1),[u,j]=n.useState(!1),[_,U]=n.useState(0);n.useEffect(()=>{if(a!=null&&a.id&&(t!=null&&t.id)){y();const l=setInterval(y,3e4);return()=>clearInterval(l)}},[a==null?void 0:a.id,t==null?void 0:t.id]);const y=()=>L(void 0,null,function*(){try{const{data:l}=yield x.from("org_staff").select("id, can_handle_escalations").eq("organization_id",a.id).eq("user_id",t.id).maybeSingle();if(!l)return;let D=x.from("escalations").select("id",{count:"exact",head:!0}).neq("status","resolved");l.can_handle_escalations?D=D.in("status",["open","in_progress"]):D=D.eq("assigned_staff_id",l.id).eq("status","in_progress");const{count:v}=yield D;U(v||0)}catch(l){console.error("Error loading escalation count:",l)}}),b=()=>L(void 0,null,function*(){try{yield I(),i("/login")}catch(l){console.error("Sign out error:",l)}});return e.jsxs("div",{className:"min-h-screen bg-slate-950 flex pb-16 lg:pb-0",children:[e.jsx("aside",{className:`fixed inset-y-0 left-0 z-50 w-64 lg:w-64 md:w-20 transform transition-all duration-300 lg:translate-x-0 lg:static ${k?"translate-x-0":"-translate-x-full"}`,style:{backgroundColor:(g==null?void 0:g.primary_color)||"#1e3a8a"},children:e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-white border-opacity-10",children:[g!=null&&g.logo_url?e.jsx("img",{src:g.logo_url,alt:(a==null?void 0:a.name)||"Logo",className:"h-10 w-auto"}):e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-10 h-10 bg-white bg-opacity-20 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-xl",children:((C=a==null?void 0:a.name)==null?void 0:C.charAt(0))||"C"})}),e.jsx("span",{className:"text-white font-semibold text-lg",children:(a==null?void 0:a.name)||"Clinic"})]}),e.jsx("button",{onClick:()=>w(!1),className:"lg:hidden text-white hover:bg-white hover:bg-opacity-10 p-2 rounded-lg transition-colors",children:e.jsx(ue,{className:"w-5 h-5"})})]}),e.jsx("nav",{className:"flex-1 px-4 py-6 space-y-2 overflow-y-auto",children:Ce.map(l=>e.jsxs(ye,{to:l.path,end:l.exact,onClick:()=>w(!1),title:l.name,className:({isActive:D})=>`flex items-center space-x-3 px-4 py-3 rounded-lg transition-colors relative md:justify-center lg:justify-start ${D?"bg-white bg-opacity-20 text-white font-medium":"text-white text-opacity-80 hover:bg-white hover:bg-opacity-10 hover:text-white"}`,children:[e.jsx(l.icon,{className:"w-5 h-5 flex-shrink-0"}),e.jsx("span",{className:"flex-1 md:hidden lg:block",children:l.name}),l.badge&&_>0&&e.jsx("span",{className:"inline-flex items-center justify-center px-2 py-0.5 text-xs font-bold text-white bg-red-600 rounded-full min-w-[1.25rem] md:absolute md:top-1 md:right-1 lg:relative lg:top-auto lg:right-auto",children:_>99?"99+":_})]},l.path))}),e.jsxs("div",{className:"p-4 border-t border-white border-opacity-10 md:hidden lg:block",children:[e.jsx("div",{className:"text-xs text-white text-opacity-60 mb-2",children:"Organization"}),e.jsx("div",{className:"text-sm text-white font-medium truncate",children:(a==null?void 0:a.name)||"Unknown Organization"})]})]})}),k&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden",onClick:()=>w(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col min-h-screen",children:[e.jsx("header",{className:"bg-slate-900 border-b border-slate-800 sticky top-0 z-30",children:e.jsx("div",{className:"px-4 sm:px-6 lg:px-8 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:()=>w(!0),className:"lg:hidden text-slate-400 hover:text-white p-2 -ml-2 rounded-lg hover:bg-slate-800 transition-colors",children:e.jsx($e,{className:"w-6 h-6"})}),e.jsx("div",{className:"flex-1 lg:flex-none",children:e.jsx("h1",{className:"text-xl font-semibold text-white truncate",children:(a==null?void 0:a.name)||"Clinic Portal"})}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>j(!u),className:"flex items-center space-x-3 px-3 py-2 rounded-lg hover:bg-slate-800 transition-colors",children:[e.jsxs("div",{className:"hidden sm:block text-right",children:[e.jsx("div",{className:"text-sm font-medium text-white",children:t==null?void 0:t.full_name}),e.jsx("div",{className:"text-xs text-slate-400",children:t==null?void 0:t.email})]}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary flex items-center justify-center text-white font-semibold",children:((T=t==null?void 0:t.full_name)==null?void 0:T.charAt(0))||"U"}),e.jsx(pe,{className:`w-4 h-4 text-slate-400 transition-transform ${u?"rotate-180":""}`})]}),u&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-30",onClick:()=>j(!1)}),e.jsxs("div",{className:"absolute right-0 mt-2 w-56 bg-slate-800 border border-slate-700 rounded-lg shadow-xl z-40 overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-slate-700",children:[e.jsx("div",{className:"text-sm font-medium text-white truncate",children:t==null?void 0:t.full_name}),e.jsx("div",{className:"text-xs text-slate-400 truncate",children:t==null?void 0:t.email}),e.jsx("div",{className:"text-xs text-slate-500 mt-1 capitalize",children:(A=t==null?void 0:t.role)==null?void 0:A.replace("_"," ")})]}),e.jsxs("button",{onClick:b,className:"w-full flex items-center space-x-2 px-4 py-3 text-sm text-slate-300 hover:bg-slate-700 hover:text-white transition-colors",children:[e.jsx(Re,{className:"w-4 h-4"}),e.jsx("span",{children:"Sign Out"})]})]})]})]})]})})}),e.jsx("main",{className:"flex-1 p-4 sm:p-6 lg:p-8",children:r}),e.jsx("nav",{className:"fixed bottom-0 left-0 right-0 bg-slate-900 border-t border-slate-800 lg:hidden z-40",children:e.jsx("div",{className:"flex items-center justify-around",children:Ce.slice(0,5).map(l=>e.jsxs(ye,{to:l.path,end:l.exact,className:({isActive:D})=>`flex flex-col items-center justify-center flex-1 py-2 px-2 relative min-h-[56px] ${D?"text-primary":"text-slate-400"}`,children:[e.jsxs("div",{className:"relative",children:[e.jsx(l.icon,{className:"w-6 h-6"}),l.badge&&_>0&&e.jsx("span",{className:"absolute -top-1 -right-1 inline-flex items-center justify-center w-4 h-4 text-[10px] font-bold text-white bg-red-600 rounded-full",children:_>9?"9+":_})]}),e.jsx("span",{className:"text-[10px] mt-1 font-medium",children:l.name})]},l.path))})})]})]})},fs=()=>{const r=G(),{user:i,organization:t}=V(),[a,g]=n.useState({todayConsultations:0,yesterdayConsultations:0,queueLength:0,pendingLabReports:0,activeChats:0}),[I,k]=n.useState([]),[w,u]=n.useState([]),[j,_]=n.useState([]),[U,y]=n.useState([]),[b,C]=n.useState(!0);n.useEffect(()=>{t!=null&&t.id&&T()},[t==null?void 0:t.id]);const T=()=>L(void 0,null,function*(){try{C(!0),yield Promise.all([A(),l(),D(),v()])}catch(c){console.error("Error loading dashboard data:",c)}finally{C(!1)}}),A=()=>L(void 0,null,function*(){const c=new Date().toISOString().split("T")[0],N=new Date(Date.now()-864e5).toISOString().split("T")[0],[f,d,p,P,S]=yield Promise.all([x.from("consultations").select("id",{count:"exact",head:!0}).eq("organization_id",t.id).gte("consultation_date",c).lt("consultation_date",new Date(Date.now()+864e5).toISOString().split("T")[0]).neq("status","cancelled"),x.from("consultations").select("id",{count:"exact",head:!0}).eq("organization_id",t.id).gte("consultation_date",N).lt("consultation_date",c).neq("status","cancelled"),x.from("consultations").select("id",{count:"exact",head:!0}).eq("organization_id",t.id).eq("status","scheduled").gte("consultation_date",new Date().toISOString()),x.from("lab_orders").select("id",{count:"exact",head:!0}).eq("organization_id",t.id).in("status",["pending","sample_collected","in_progress"]),x.from("chat_sessions").select("id",{count:"exact",head:!0}).eq("organization_id",t.id).eq("status","active")]);g({todayConsultations:f.count||0,yesterdayConsultations:d.count||0,queueLength:p.count||0,pendingLabReports:P.count||0,activeChats:S.count||0})}),l=()=>L(void 0,null,function*(){const c=Array.from({length:7},(f,d)=>new Date(Date.now()-d*864e5).toISOString().split("T")[0]).reverse(),N=yield Promise.all(c.map(f=>L(void 0,null,function*(){const d=new Date(new Date(f).getTime()+864e5).toISOString().split("T")[0],{count:p}=yield x.from("consultations").select("id",{count:"exact",head:!0}).eq("organization_id",t.id).gte("consultation_date",f).lt("consultation_date",d).neq("status","cancelled");return{date:new Date(f).toLocaleDateString("en-US",{month:"short",day:"numeric"}),count:p||0}})));k(N)}),D=()=>L(void 0,null,function*(){const c=["pending","sample_collected","in_progress","completed"],N=["#f59e0b","#3b82f6","#8b5cf6","#10b981"],f=yield Promise.all(c.map((d,p)=>L(void 0,null,function*(){const{count:P}=yield x.from("lab_orders").select("id",{count:"exact",head:!0}).eq("organization_id",t.id).eq("status",d);return{name:d.split("_").map(S=>S.charAt(0).toUpperCase()+S.slice(1)).join(" "),value:P||0,color:N[p]}})));u(f)}),v=()=>L(void 0,null,function*(){const{data:c}=yield x.from("consultations").select("id, patient_id, consultation_date, status").eq("organization_id",t.id).order("created_at",{ascending:!1}).limit(5);if(c){const f=yield Promise.all(c.map(d=>L(void 0,null,function*(){const{data:p}=yield x.from("patients").select("full_name").eq("id",d.patient_id).maybeSingle();return{id:d.id,patient_name:(p==null?void 0:p.full_name)||"Unknown Patient",consultation_date:d.consultation_date,status:d.status}})));_(f)}const{data:N}=yield x.from("lab_orders").select("id, patient_id, status, created_at").eq("organization_id",t.id).order("created_at",{ascending:!1}).limit(5);if(N){const f=yield Promise.all(N.map(d=>L(void 0,null,function*(){var $,m;const[p,P]=yield Promise.all([x.from("patients").select("full_name").eq("id",d.patient_id).maybeSingle(),x.from("lab_order_tests").select("lab_tests(name)").eq("lab_order_id",d.id)]),S=(($=P.data)==null?void 0:$.map(E=>{var M;return(M=E.lab_tests)==null?void 0:M.name}).filter(Boolean).join(", "))||"No tests";return{id:d.id,patient_name:((m=p.data)==null?void 0:m.full_name)||"Unknown Patient",test_names:S,status:d.status,created_at:d.created_at}})));y(f)}}),F=()=>{const c=a.todayConsultations-a.yesterdayConsultations;return c>0?e.jsxs("span",{className:"inline-flex items-center text-green-400 text-sm",children:[e.jsx(Be,{className:"w-4 h-4 mr-1"}),"+",c," vs yesterday"]}):c<0?e.jsxs("span",{className:"inline-flex items-center text-red-400 text-sm",children:[e.jsx(ze,{className:"w-4 h-4 mr-1"}),c," vs yesterday"]}):e.jsx("span",{className:"text-slate-400 text-sm",children:"Same as yesterday"})},o=c=>{const N={scheduled:"bg-blue-900 text-blue-300 border-blue-700",completed:"bg-green-900 text-green-300 border-green-700",in_progress:"bg-amber-900 text-amber-300 border-amber-700",pending:"bg-slate-900 text-slate-300 border-slate-700",sample_collected:"bg-purple-900 text-purple-300 border-purple-700"};return e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded border ${N[c]||N.pending}`,children:c.split("_").map(f=>f.charAt(0).toUpperCase()+f.slice(1)).join(" ")})},s=c=>new Date(c).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});if(b)return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-primary to-secondary rounded-lg p-8 text-white shadow-xl",children:[e.jsx("div",{className:"h-8 bg-white bg-opacity-20 rounded w-64 mb-2 animate-pulse"}),e.jsx("div",{className:"h-6 bg-white bg-opacity-20 rounded w-48 animate-pulse"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[1,2,3,4].map(c=>e.jsx(Z,{className:"bg-slate-800 border-slate-700",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-4 bg-slate-700 rounded w-32 mb-3"}),e.jsx("div",{className:"h-8 bg-slate-700 rounded w-20"})]})},c))}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[1,2].map(c=>e.jsx(Z,{className:"bg-slate-800 border-slate-700",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-6 bg-slate-700 rounded w-40 mb-4"}),e.jsx("div",{className:"space-y-3",children:e.jsx("div",{className:"h-32 bg-slate-700 rounded"})})]})},c))})]});const h=[{title:"Today's Consultations",value:a.todayConsultations,icon:H,color:"text-blue-400",bgColor:"bg-blue-900 bg-opacity-20",trend:F()},{title:"Queue Length",value:a.queueLength,icon:de,color:"text-purple-400",bgColor:"bg-purple-900 bg-opacity-20",subtitle:"Scheduled appointments"},{title:"Pending Lab Reports",value:a.pendingLabReports,icon:Q,color:"text-amber-400",bgColor:"bg-amber-900 bg-opacity-20",subtitle:"Awaiting results"},{title:"Active Chats",value:a.activeChats,icon:me,color:"text-green-400",bgColor:"bg-green-900 bg-opacity-20",subtitle:"Ongoing conversations"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-primary to-secondary rounded-lg p-8 text-white shadow-xl",children:[e.jsxs("h1",{className:"text-3xl font-bold mb-2",children:["Welcome back, ",(i==null?void 0:i.full_name)||"User","!"]}),e.jsx("p",{className:"text-white text-opacity-90 text-lg",children:(t==null?void 0:t.name)||"Your Organization"}),e.jsx("p",{className:"text-white text-opacity-75 mt-2",children:"Here's what's happening today in your clinic"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:h.map(c=>e.jsx(Z,{className:"bg-slate-800 border-slate-700",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-slate-400 mb-1",children:c.title}),e.jsx("p",{className:"text-3xl font-bold text-white mb-2",children:c.value}),c.trend&&e.jsx("div",{className:"mt-2",children:c.trend}),c.subtitle&&e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:c.subtitle})]}),e.jsx("div",{className:`${c.bgColor} p-3 rounded-lg`,children:e.jsx(c.icon,{className:`w-6 h-6 ${c.color}`})})]})},c.title))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(Z,{className:"bg-slate-800 border-slate-700",children:[e.jsxs("h2",{className:"text-xl font-semibold text-white mb-4 flex items-center",children:[e.jsx(Oe,{className:"w-5 h-5 mr-2 text-primary"}),"Consultations Last 7 Days"]}),I.length>0?e.jsx(_e,{width:"100%",height:250,children:e.jsxs(as,{data:I,children:[e.jsx(rs,{strokeDasharray:"3 3",stroke:"#334155"}),e.jsx(ls,{dataKey:"date",stroke:"#94a3b8",style:{fontSize:"12px"}}),e.jsx(is,{stroke:"#94a3b8",style:{fontSize:"12px"}}),e.jsx(Se,{contentStyle:{backgroundColor:"#1e293b",border:"1px solid #334155",borderRadius:"8px",color:"#fff"}}),e.jsx(ns,{}),e.jsx(os,{type:"monotone",dataKey:"count",name:"Consultations",stroke:"#3b82f6",strokeWidth:2,dot:{fill:"#3b82f6",r:4},activeDot:{r:6}})]})}):e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("p",{className:"text-slate-400",children:"No consultation data available"})})]}),e.jsxs(Z,{className:"bg-slate-800 border-slate-700",children:[e.jsxs("h2",{className:"text-xl font-semibold text-white mb-4 flex items-center",children:[e.jsx(Q,{className:"w-5 h-5 mr-2 text-primary"}),"Lab Orders by Status"]}),w.some(c=>c.value>0)?e.jsx(_e,{width:"100%",height:250,children:e.jsxs(cs,{children:[e.jsx(ds,{data:w.filter(c=>c.value>0),cx:"50%",cy:"50%",labelLine:!1,label:({name:c,percent:N})=>`${c}: ${(N*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:w.map((c,N)=>e.jsx(ms,{fill:c.color},`cell-${N}`))}),e.jsx(Se,{contentStyle:{backgroundColor:"#1e293b",border:"1px solid #334155",borderRadius:"8px",color:"#fff"}})]})}):e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("p",{className:"text-slate-400",children:"No lab orders data available"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(Z,{className:"bg-slate-800 border-slate-700",children:[e.jsxs("h2",{className:"text-xl font-semibold text-white mb-4 flex items-center",children:[e.jsx(H,{className:"w-5 h-5 mr-2 text-primary"}),"Recent Consultations"]}),j.length>0?e.jsx("div",{className:"space-y-2",children:j.map(c=>e.jsxs("button",{onClick:()=>r(`/portal/consultations/${c.id}`),className:"w-full p-3 bg-slate-750 hover:bg-slate-700 border border-slate-700 rounded-lg transition-colors text-left",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-white",children:c.patient_name}),o(c.status)]}),e.jsxs("div",{className:"flex items-center text-xs text-slate-400",children:[e.jsx(te,{className:"w-3 h-3 mr-1"}),s(c.consultation_date)]})]},c.id))}):e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("p",{className:"text-slate-400",children:"No recent consultations"})})]}),e.jsxs(Z,{className:"bg-slate-800 border-slate-700",children:[e.jsxs("h2",{className:"text-xl font-semibold text-white mb-4 flex items-center",children:[e.jsx(Q,{className:"w-5 h-5 mr-2 text-primary"}),"Recent Lab Orders"]}),U.length>0?e.jsx("div",{className:"space-y-2",children:U.map(c=>e.jsxs("button",{onClick:()=>r("/portal/lab-orders"),className:"w-full p-3 bg-slate-750 hover:bg-slate-700 border border-slate-700 rounded-lg transition-colors text-left",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-white",children:c.patient_name}),o(c.status)]}),e.jsx("p",{className:"text-xs text-slate-400 mb-2 truncate",children:c.test_names}),e.jsxs("div",{className:"flex items-center text-xs text-slate-500",children:[e.jsx(te,{className:"w-3 h-3 mr-1"}),s(c.created_at)]})]},c.id))}):e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("p",{className:"text-slate-400",children:"No recent lab orders"})})]})]})]})},gs=({isOpen:r,onClose:i,onSuccess:t,organizationId:a})=>{const[g,I]=n.useState(!1),[k,w]=n.useState({}),[u,j]=n.useState({full_name:"",age:"",gender:"",phone:"",email:"",address:"",medical_history:""}),_=()=>{const b={};return u.full_name.trim()?u.full_name.trim().length<2&&(b.full_name="Name must be at least 2 characters"):b.full_name="Patient name is required",u.phone.trim()?u.phone.replace(/[\s\-\(\)]/g,"").length<10&&(b.phone="Phone number must be at least 10 digits"):b.phone="Phone number is required",u.email&&!u.email.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)&&(b.email="Please enter a valid email address"),u.age&&(parseInt(u.age)<0||parseInt(u.age)>150)&&(b.age="Please enter a valid age"),w(b),Object.keys(b).length===0},U=b=>L(void 0,null,function*(){if(b.preventDefault(),!!_())try{I(!0);const C={organization_id:a,full_name:u.full_name.trim(),age:u.age?parseInt(u.age):null,gender:u.gender||null,phone:u.phone.trim(),email:u.email.trim()||null,address:u.address.trim()||null,medical_history:u.medical_history.trim()||null},{error:T}=yield x.from("patients").insert([C]);if(T)throw T;q.success("Patient added successfully"),j({full_name:"",age:"",gender:"",phone:"",email:"",address:"",medical_history:""}),w({}),t(),i()}catch(C){console.error("Error adding patient:",C),q.error(C.message||"Failed to add patient")}finally{I(!1)}}),y=b=>{w(C=>{const T=R({},C);return delete T[b],T})};return r?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-slate-800 rounded-lg shadow-2xl w-full max-w-2xl my-4 sm:my-8 flex flex-col border border-slate-700",children:[e.jsxs("div",{className:"bg-slate-900 border-b border-slate-700 px-4 sm:px-6 py-4 flex items-center justify-between rounded-t-lg",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-white",children:"Add New Patient"}),e.jsx("button",{onClick:i,disabled:g,className:"text-slate-400 hover:text-white transition-colors p-2 -mr-2 min-h-[44px] min-w-[44px] flex items-center justify-center",children:e.jsx(ue,{className:"w-5 h-5"})})]}),e.jsx("form",{onSubmit:U,className:"overflow-y-auto p-4 sm:p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(re,{label:"Full Name",type:"text",value:u.full_name,onChange:b=>{j(O(R({},u),{full_name:b.target.value})),y("full_name")},error:k.full_name,placeholder:"Enter patient name",required:!0,disabled:g}),e.jsx(re,{label:"Age",type:"number",min:"0",max:"150",value:u.age,onChange:b=>{j(O(R({},u),{age:b.target.value})),y("age")},error:k.age,placeholder:"Enter age",disabled:g})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Gender"}),e.jsxs("select",{value:u.gender,onChange:b=>j(O(R({},u),{gender:b.target.value})),disabled:g,className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary disabled:opacity-50",children:[e.jsx("option",{value:"",children:"Select gender"}),e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsx(re,{label:"Phone",type:"tel",value:u.phone,onChange:b=>{j(O(R({},u),{phone:b.target.value})),y("phone")},error:k.phone,placeholder:"Enter phone number",required:!0,disabled:g})]}),e.jsx(re,{label:"Email",type:"email",value:u.email,onChange:b=>{j(O(R({},u),{email:b.target.value})),y("email")},error:k.email,placeholder:"Enter email address",disabled:g}),e.jsx(re,{label:"Address",type:"text",value:u.address,onChange:b=>j(O(R({},u),{address:b.target.value})),placeholder:"Enter address",disabled:g}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Medical History"}),e.jsx("textarea",{value:u.medical_history,onChange:b=>j(O(R({},u),{medical_history:b.target.value})),rows:4,disabled:g,className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary resize-none disabled:opacity-50",placeholder:"Enter relevant medical history, allergies, chronic conditions, etc."})]})]})}),e.jsxs("div",{className:"bg-slate-900 border-t border-slate-700 px-4 sm:px-6 py-4 flex flex-col-reverse sm:flex-row items-stretch sm:items-center justify-end gap-3 rounded-b-lg",children:[e.jsx("button",{type:"button",onClick:i,className:"px-4 py-2.5 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors disabled:opacity-50 min-h-[44px]",disabled:g,children:"Cancel"}),e.jsx("button",{onClick:U,disabled:g,className:"px-4 py-2.5 bg-primary hover:bg-opacity-80 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed inline-flex items-center justify-center min-h-[44px]",children:g?e.jsxs(e.Fragment,{children:[e.jsx(We,{className:"w-4 h-4 mr-2 animate-spin"}),"Adding..."]}):"Add Patient"})]})]})}):null},js=()=>{const r=G(),{organization:i}=V(),[t,a]=n.useState([]),[g,I]=n.useState(!0),[k,w]=n.useState(null),[u,j]=n.useState(!1),[_,U]=n.useState(""),[y,b]=n.useState(1),[C,T]=n.useState(0),A=20;n.useEffect(()=>{i!=null&&i.id&&l()},[i==null?void 0:i.id,y,_]);const l=()=>L(void 0,null,function*(){try{I(!0),w(null);let o=x.from("patients").select("*",{count:"exact"}).eq("organization_id",i.id).order("created_at",{ascending:!1});_.trim()&&(o=o.or(`full_name.ilike.%${_}%,phone.ilike.%${_}%`));const s=(y-1)*A,h=s+A-1,{data:c,error:N,count:f}=yield o.range(s,h);if(N)throw N;a(c||[]),T(f||0)}catch(o){console.error("Error loading patients:",o),w(o.message||"Failed to load patients"),q.error("Failed to load patients")}finally{I(!1)}}),D=Math.ceil(C/A),v=o=>{U(o),b(1)},F=o=>{if(!o)return e.jsx("span",{className:"text-slate-500 text-sm",children:"-"});const s={male:"bg-blue-900 text-blue-300 border-blue-700",female:"bg-pink-900 text-pink-300 border-pink-700",other:"bg-purple-900 text-purple-300 border-purple-700"};return e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded border ${s[o]||"bg-slate-700 text-slate-300 border-slate-600"}`,children:o.charAt(0).toUpperCase()+o.slice(1)})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Patients"}),e.jsx("p",{className:"text-slate-400",children:"Manage your patient records"})]}),e.jsxs("button",{onClick:()=>j(!0),className:"inline-flex items-center px-4 py-2 bg-primary hover:bg-opacity-80 text-white rounded-lg transition-colors font-medium",children:[e.jsx(K,{className:"w-5 h-5 mr-2"}),"Add Patient"]})]}),e.jsx("div",{className:"bg-slate-800 border border-slate-700 rounded-lg p-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(ve,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400"}),e.jsx("input",{type:"text",value:_,onChange:o=>v(o.target.value),placeholder:"Search by name or phone...",className:"w-full pl-10 pr-4 py-2 bg-slate-900 border border-slate-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary"})]})}),k?e.jsx(ps,{title:"Failed to load patients",message:k,onRetry:l}):g?e.jsx(hs,{rows:10,columns:6}):t.length===0?e.jsx(us,{icon:_?ve:de,title:_?"No patients found":"No patients yet",description:_?"Try adjusting your search criteria":"Get started by adding your first patient",action:_?void 0:{label:"Add Patient",onClick:()=>j(!0)}}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden md:block bg-slate-800 border border-slate-700 rounded-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-900 border-b border-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-300 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-300 uppercase tracking-wider",children:"Age"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-300 uppercase tracking-wider",children:"Gender"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-300 uppercase tracking-wider",children:"Phone"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-300 uppercase tracking-wider",children:"Last Visit"}),e.jsx("th",{className:"px-6 py-4 text-right text-xs font-semibold text-slate-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-700",children:t.map(o=>e.jsxs("tr",{className:"hover:bg-slate-750 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm font-medium text-white",children:o.full_name})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-slate-300",children:o.age||e.jsx("span",{className:"text-slate-500",children:"-"})})}),e.jsx("td",{className:"px-6 py-4",children:F(o.gender)}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-slate-300",children:o.phone||e.jsx("span",{className:"text-slate-500",children:"-"})})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-slate-300",children:o.last_visit_date?new Date(o.last_visit_date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):e.jsx("span",{className:"text-slate-500",children:"No visits"})})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsxs("button",{onClick:()=>r(`/portal/patients/${o.id}`),className:"inline-flex items-center px-3 py-1.5 text-sm font-medium text-blue-300 bg-blue-900 hover:bg-blue-800 border border-blue-700 rounded-lg transition-colors",children:[e.jsx(oe,{className:"w-4 h-4 mr-1"}),"View"]}),e.jsxs("button",{onClick:()=>r(`/portal/consultations/new?patientId=${o.id}`),className:"inline-flex items-center px-3 py-1.5 text-sm font-medium text-green-300 bg-green-900 hover:bg-green-800 border border-green-700 rounded-lg transition-colors",children:[e.jsx(H,{className:"w-4 h-4 mr-1"}),"Consult"]})]})})]},o.id))})]})})}),e.jsx("div",{className:"md:hidden space-y-3",children:t.map(o=>e.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-lg p-4 space-y-3",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-base font-semibold text-white mb-1",children:o.full_name}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-slate-400",children:[o.age&&e.jsxs("span",{children:[o.age," years"]}),o.age&&o.gender&&e.jsx("span",{children:"•"}),o.gender&&F(o.gender)]})]})}),e.jsxs("div",{className:"space-y-2 text-sm",children:[o.phone&&e.jsxs("div",{className:"flex items-center space-x-2 text-slate-300",children:[e.jsx("span",{className:"text-slate-500",children:"Phone:"}),e.jsx("span",{children:o.phone})]}),o.last_visit_date&&e.jsxs("div",{className:"flex items-center space-x-2 text-slate-300",children:[e.jsx("span",{className:"text-slate-500",children:"Last Visit:"}),e.jsx("span",{children:new Date(o.last_visit_date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-2 border-t border-slate-700",children:[e.jsxs("button",{onClick:()=>r(`/portal/patients/${o.id}`),className:"flex-1 inline-flex items-center justify-center px-3 py-2 text-sm font-medium text-blue-300 bg-blue-900 hover:bg-blue-800 border border-blue-700 rounded-lg transition-colors",children:[e.jsx(oe,{className:"w-4 h-4 mr-1.5"}),"View"]}),e.jsxs("button",{onClick:()=>r(`/portal/consultations/new?patientId=${o.id}`),className:"flex-1 inline-flex items-center justify-center px-3 py-2 text-sm font-medium text-green-300 bg-green-900 hover:bg-green-800 border border-green-700 rounded-lg transition-colors",children:[e.jsx(H,{className:"w-4 h-4 mr-1.5"}),"Consult"]})]})]},o.id))}),D>1&&e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4 bg-slate-800 border border-slate-700 rounded-lg px-4 sm:px-6 py-4",children:[e.jsxs("div",{className:"text-xs sm:text-sm text-slate-400",children:["Showing ",(y-1)*A+1," to"," ",Math.min(y*A,C)," of ",C," patients"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>b(o=>Math.max(1,o-1)),disabled:y===1,className:"p-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed min-h-[44px] min-w-[44px] flex items-center justify-center",children:e.jsx(be,{className:"w-5 h-5"})}),e.jsxs("span",{className:"text-xs sm:text-sm text-slate-300 px-2",children:["Page ",y," of ",D]}),e.jsx("button",{onClick:()=>b(o=>Math.min(D,o+1)),disabled:y===D,className:"p-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed min-h-[44px] min-w-[44px] flex items-center justify-center",children:e.jsx(fe,{className:"w-5 h-5"})})]})]})]}),e.jsx(gs,{isOpen:u,onClose:()=>j(!1),onSuccess:l,organizationId:i.id})]})},Ns=({consultation:r})=>{const[i,t]=n.useState(!1);return e.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-lg p-4 hover:border-slate-600 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-900 rounded-full flex items-center justify-center",children:e.jsx(ee,{className:"w-5 h-5 text-blue-300"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-white",children:"Consultation"}),e.jsx("div",{className:"text-xs text-slate-400",children:new Date(r.consultation_date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})})]})]}),e.jsx("button",{onClick:()=>t(!i),className:"p-1 hover:bg-slate-800 rounded transition-colors",children:i?e.jsx(qe,{className:"w-5 h-5 text-slate-400"}):e.jsx(pe,{className:"w-5 h-5 text-slate-400"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(X,{className:"w-4 h-4 text-slate-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Doctor"}),e.jsx("div",{className:"text-sm text-white",children:r.doctor_name||"Unknown"})]})]}),r.chief_complaint&&e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(ee,{className:"w-4 h-4 text-slate-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Chief Complaint"}),e.jsx("div",{className:"text-sm text-slate-300",children:r.chief_complaint})]})]}),i&&e.jsxs(e.Fragment,{children:[r.diagnosis&&e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(ee,{className:"w-4 h-4 text-slate-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Diagnosis"}),e.jsx("div",{className:"text-sm text-slate-300",children:r.diagnosis})]})]}),r.notes&&e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(ee,{className:"w-4 h-4 text-slate-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Notes"}),e.jsx("div",{className:"text-sm text-slate-300 whitespace-pre-wrap",children:r.notes})]})]}),r.follow_up_date&&e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(H,{className:"w-4 h-4 text-slate-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Follow-up Date"}),e.jsx("div",{className:"text-sm text-slate-300",children:new Date(r.follow_up_date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})})]})]})]})]})]})},ys=({prescription:r})=>{const[i,t]=n.useState(!1);return e.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-lg p-4 hover:border-slate-600 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-900 rounded-full flex items-center justify-center",children:e.jsx(ie,{className:"w-5 h-5 text-green-300"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-white",children:"Prescription"}),e.jsx("div",{className:"text-xs text-slate-400",children:new Date(r.prescription_date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})})]})]}),e.jsx("button",{onClick:()=>t(!i),className:"p-1 hover:bg-slate-800 rounded transition-colors",children:i?e.jsx(qe,{className:"w-5 h-5 text-slate-400"}):e.jsx(pe,{className:"w-5 h-5 text-slate-400"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(X,{className:"w-4 h-4 text-slate-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Prescribed by"}),e.jsx("div",{className:"text-sm text-white",children:r.doctor_name||"Unknown"})]})]}),r.items&&r.items.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"text-xs text-slate-500 mb-2",children:"Medications"}),e.jsxs("div",{className:"space-y-2",children:[r.items.slice(0,i?void 0:2).map((a,g)=>e.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded p-3 text-sm",children:[e.jsx("div",{className:"font-medium text-white mb-1",children:a.medicine_name}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs text-slate-400",children:[a.dosage&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500",children:"Dosage:"})," ",a.dosage]}),a.frequency&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500",children:"Frequency:"})," ",a.frequency]}),a.duration&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"text-slate-500",children:"Duration:"})," ",a.duration]})]})]},g)),!i&&r.items.length>2&&e.jsxs("div",{className:"text-xs text-slate-400",children:["+",r.items.length-2," more medication(s)"]})]})]}),i&&r.notes&&e.jsxs("div",{className:"flex items-start space-x-2 mt-3",children:[e.jsx(ee,{className:"w-4 h-4 text-slate-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Notes"}),e.jsx("div",{className:"text-sm text-slate-300 whitespace-pre-wrap",children:r.notes})]})]})]})]})},vs=({labOrder:r})=>{const i=t=>{const a={pending:"bg-amber-900 text-amber-300 border-amber-700",completed:"bg-green-900 text-green-300 border-green-700",cancelled:"bg-red-900 text-red-300 border-red-700"};return e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded border ${a[t]||a.pending}`,children:t.charAt(0).toUpperCase()+t.slice(1)})};return e.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-lg p-4 hover:border-slate-600 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-900 rounded-full flex items-center justify-center",children:e.jsx(Q,{className:"w-5 h-5 text-purple-300"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-white",children:"Lab Order"}),e.jsx("div",{className:"text-xs text-slate-400",children:new Date(r.created_at).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})})]})]}),i(r.status)]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(X,{className:"w-4 h-4 text-slate-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Ordered by"}),e.jsx("div",{className:"text-sm text-white",children:r.doctor_name||"Unknown"})]})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(Q,{className:"w-4 h-4 text-slate-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Tests"}),e.jsx("div",{className:"text-sm text-slate-300",children:r.test_names})]})]}),r.result_date&&e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(te,{className:"w-4 h-4 text-slate-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Result Date"}),e.jsx("div",{className:"text-sm text-slate-300",children:new Date(r.result_date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})})]})]})]})]})},ws=()=>{const{id:r}=ne(),i=G(),{organization:t}=V(),[a,g]=n.useState(null),[I,k]=n.useState([]),[w,u]=n.useState([]),[j,_]=n.useState([]),[U,y]=n.useState(!0),[b,C]=n.useState("consultations");n.useEffect(()=>{r&&(t!=null&&t.id)&&T()},[r,t==null?void 0:t.id]);const T=()=>L(void 0,null,function*(){try{y(!0);const{data:l,error:D}=yield x.from("patients").select("*").eq("id",r).eq("organization_id",t.id).maybeSingle();if(D)throw D;if(!l){q.error("Patient not found"),i("/portal/patients");return}g(l);const[v,F,o]=yield Promise.all([x.from("consultations").select("*").eq("patient_id",r).order("consultation_date",{ascending:!1}),x.from("prescriptions").select("*").eq("patient_id",r).order("prescription_date",{ascending:!1}),x.from("lab_orders").select("*").eq("patient_id",r).order("created_at",{ascending:!1})]);if(v.error)throw v.error;if(F.error)throw F.error;if(o.error)throw o.error;const s=yield Promise.all((v.data||[]).map(N=>L(void 0,null,function*(){const{data:f}=yield x.from("org_staff").select("user_id").eq("id",N.doctor_id).maybeSingle();let d="Unknown";if(f!=null&&f.user_id){const{data:p}=yield x.from("auth.users").select("email").eq("id",f.user_id).maybeSingle();d=(p==null?void 0:p.email)||"Unknown"}return O(R({},N),{doctor_name:d})}))),h=yield Promise.all((F.data||[]).map(N=>L(void 0,null,function*(){const{data:f}=yield x.from("org_staff").select("user_id").eq("id",N.doctor_id).maybeSingle();let d="Unknown";if(f!=null&&f.user_id){const{data:P}=yield x.from("auth.users").select("email").eq("id",f.user_id).maybeSingle();d=(P==null?void 0:P.email)||"Unknown"}const{data:p}=yield x.from("prescription_items").select("*").eq("prescription_id",N.id);return O(R({},N),{doctor_name:d,items:p||[]})}))),c=yield Promise.all((o.data||[]).map(N=>L(void 0,null,function*(){const{data:f}=yield x.from("org_staff").select("user_id").eq("id",N.doctor_id).maybeSingle();let d="Unknown";if(f!=null&&f.user_id){const{data:p}=yield x.from("auth.users").select("email").eq("id",f.user_id).maybeSingle();d=(p==null?void 0:p.email)||"Unknown"}return O(R({},N),{doctor_name:d})})));k(s),u(h),_(c)}catch(l){console.error("Error loading patient data:",l),q.error("Failed to load patient data")}finally{y(!1)}});if(U)return e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400",children:"Loading patient data..."})]})});if(!a)return e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-slate-400",children:"Patient not found"})});const A=l=>l?l.charAt(0).toUpperCase()+l.slice(1):"-";return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("button",{onClick:()=>i("/portal/patients"),className:"inline-flex items-center text-slate-400 hover:text-white transition-colors",children:[e.jsx(se,{className:"w-5 h-5 mr-2"}),"Back to Patients"]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-lg overflow-hidden sticky top-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-primary to-secondary p-6",children:[e.jsx("div",{className:"w-20 h-20 bg-white bg-opacity-20 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(X,{className:"w-10 h-10 text-white"})}),e.jsx("h2",{className:"text-2xl font-bold text-white text-center mb-1",children:a.full_name}),e.jsxs("p",{className:"text-white text-opacity-80 text-center text-sm",children:[a.age?`${a.age} years old`:"Age not specified"," •"," ",A(a.gender)]})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500 uppercase tracking-wider mb-2",children:"Contact Information"}),e.jsxs("div",{className:"space-y-3",children:[a.phone&&e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Ve,{className:"w-4 h-4 text-slate-400 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-slate-300",children:a.phone})]}),a.email&&e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Ge,{className:"w-4 h-4 text-slate-400 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-slate-300 break-all",children:a.email})]}),a.address&&e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(Qe,{className:"w-4 h-4 text-slate-400 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-sm text-slate-300",children:a.address})]}),!a.phone&&!a.email&&!a.address&&e.jsx("p",{className:"text-sm text-slate-500 italic",children:"No contact information"})]})]}),a.medical_history&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500 uppercase tracking-wider mb-2",children:"Medical History"}),e.jsx("div",{className:"bg-slate-900 border border-slate-700 rounded p-3",children:e.jsx("p",{className:"text-sm text-slate-300 whitespace-pre-wrap",children:a.medical_history})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500 uppercase tracking-wider mb-2",children:"Patient Since"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(H,{className:"w-4 h-4 text-slate-400"}),e.jsx("span",{className:"text-sm text-slate-300",children:new Date(a.created_at).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})})]})]}),a.last_visit_date&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500 uppercase tracking-wider mb-2",children:"Last Visit"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(te,{className:"w-4 h-4 text-slate-400"}),e.jsx("span",{className:"text-sm text-slate-300",children:new Date(a.last_visit_date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})})]})]})]})]})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-lg overflow-hidden",children:[e.jsx("div",{className:"border-b border-slate-700",children:e.jsxs("div",{className:"flex space-x-1 p-1",children:[e.jsxs("button",{onClick:()=>C("consultations"),className:`flex-1 px-4 py-3 text-sm font-medium rounded transition-colors ${b==="consultations"?"bg-slate-900 text-white":"text-slate-400 hover:text-white hover:bg-slate-750"}`,children:[e.jsx(ee,{className:"w-4 h-4 inline-block mr-2"}),"Consultations (",I.length,")"]}),e.jsxs("button",{onClick:()=>C("prescriptions"),className:`flex-1 px-4 py-3 text-sm font-medium rounded transition-colors ${b==="prescriptions"?"bg-slate-900 text-white":"text-slate-400 hover:text-white hover:bg-slate-750"}`,children:[e.jsx(ie,{className:"w-4 h-4 inline-block mr-2"}),"Prescriptions (",w.length,")"]}),e.jsxs("button",{onClick:()=>C("lab_orders"),className:`flex-1 px-4 py-3 text-sm font-medium rounded transition-colors ${b==="lab_orders"?"bg-slate-900 text-white":"text-slate-400 hover:text-white hover:bg-slate-750"}`,children:[e.jsx(Q,{className:"w-4 h-4 inline-block mr-2"}),"Lab Orders (",j.length,")"]})]})}),e.jsxs("div",{className:"p-6",children:[b==="consultations"&&e.jsx("div",{className:"space-y-4",children:I.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ee,{className:"w-16 h-16 text-slate-600 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400 mb-2",children:"No consultations yet"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Start a new consultation to begin the patient's medical record"})]}):I.map(l=>e.jsx(Ns,{consultation:l},l.id))}),b==="prescriptions"&&e.jsx("div",{className:"space-y-4",children:w.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ie,{className:"w-16 h-16 text-slate-600 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400 mb-2",children:"No prescriptions yet"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Prescriptions will appear here when issued"})]}):w.map(l=>e.jsx(ys,{prescription:l},l.id))}),b==="lab_orders"&&e.jsx("div",{className:"space-y-4",children:j.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Q,{className:"w-16 h-16 text-slate-600 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400 mb-2",children:"No lab orders yet"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Lab orders will appear here when ordered"})]}):j.map(l=>e.jsx(vs,{labOrder:l},l.id))})]})]})})]}),e.jsx("button",{onClick:()=>i(`/portal/consultations/new?patientId=${a.id}`),className:"fixed bottom-8 right-8 w-14 h-14 bg-primary hover:bg-opacity-80 text-white rounded-full shadow-2xl flex items-center justify-center transition-all hover:scale-110 z-40",children:e.jsx(K,{className:"w-6 h-6"})})]})},_s=()=>{const r=G(),{organization:i}=V(),[t,a]=n.useState([]),[g,I]=n.useState([]),[k,w]=n.useState(!0),[u,j]=n.useState(1),[_,U]=n.useState(0),[y,b]=n.useState({dateFrom:"",dateTo:"",status:"",doctorId:""}),C=20;n.useEffect(()=>{i!=null&&i.id&&(T(),A())},[i==null?void 0:i.id,u,y]);const T=()=>L(void 0,null,function*(){try{const{data:s,error:h}=yield x.from("org_staff").select("id, user_id").eq("organization_id",i.id).eq("role","doctor");if(h)throw h;const c=yield Promise.all((s||[]).map(N=>L(void 0,null,function*(){const{data:f}=yield x.from("users").select("full_name").eq("id",N.user_id).maybeSingle();return{id:N.id,user_id:N.user_id,full_name:(f==null?void 0:f.full_name)||"Unknown Doctor"}})));I(c)}catch(s){console.error("Error loading doctors:",s)}}),A=()=>L(void 0,null,function*(){try{w(!0);let s=x.from("consultations").select("*",{count:"exact"}).eq("organization_id",i.id).order("consultation_date",{ascending:!1});y.dateFrom&&(s=s.gte("consultation_date",y.dateFrom)),y.dateTo&&(s=s.lte("consultation_date",y.dateTo)),y.status&&(s=s.eq("status",y.status)),y.doctorId&&(s=s.eq("doctor_id",y.doctorId));const h=(u-1)*C,c=h+C-1,{data:N,error:f,count:d}=yield s.range(h,c);if(f)throw f;const p=yield Promise.all((N||[]).map(P=>L(void 0,null,function*(){const{data:S}=yield x.from("patients").select("full_name").eq("id",P.patient_id).maybeSingle(),$=g.find(m=>m.id===P.doctor_id);return O(R({},P),{patient_name:(S==null?void 0:S.full_name)||"Unknown Patient",doctor_name:($==null?void 0:$.full_name)||"Unknown Doctor"})})));a(p),U(d||0)}catch(s){console.error("Error loading consultations:",s),q.error("Failed to load consultations")}finally{w(!1)}}),l=(s,h)=>{b(O(R({},y),{[s]:h})),j(1)},D=()=>{b({dateFrom:"",dateTo:"",status:"",doctorId:""}),j(1)},v=Math.ceil(_/C),F=s=>{const h={scheduled:"bg-blue-900 text-blue-300 border-blue-700",completed:"bg-green-900 text-green-300 border-green-700",cancelled:"bg-red-900 text-red-300 border-red-700",in_progress:"bg-amber-900 text-amber-300 border-amber-700"};return e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded border ${h[s]||h.scheduled}`,children:s.replace("_"," ").charAt(0).toUpperCase()+s.slice(1).replace("_"," ")})},o=y.dateFrom||y.dateTo||y.status||y.doctorId;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Consultations"}),e.jsx("p",{className:"text-slate-400",children:"Manage patient consultations and medical records"})]}),e.jsxs("button",{onClick:()=>r("/portal/consultations/new"),className:"inline-flex items-center px-4 py-2 bg-primary hover:bg-opacity-80 text-white rounded-lg transition-colors font-medium",children:[e.jsx(K,{className:"w-5 h-5 mr-2"}),"New Consultation"]})]}),e.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(ge,{className:"w-5 h-5 text-slate-400"}),e.jsx("span",{className:"text-sm font-medium text-white",children:"Filters"}),o&&e.jsx("button",{onClick:D,className:"text-xs text-primary hover:text-opacity-80 ml-auto",children:"Clear All"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-400 mb-2",children:"Date From"}),e.jsx("input",{type:"date",value:y.dateFrom,onChange:s=>l("dateFrom",s.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-400 mb-2",children:"Date To"}),e.jsx("input",{type:"date",value:y.dateTo,onChange:s=>l("dateTo",s.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-400 mb-2",children:"Status"}),e.jsxs("select",{value:y.status,onChange:s=>l("status",s.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary text-sm",children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"scheduled",children:"Scheduled"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-400 mb-2",children:"Doctor"}),e.jsxs("select",{value:y.doctorId,onChange:s=>l("doctorId",s.target.value),className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary text-sm",children:[e.jsx("option",{value:"",children:"All Doctors"}),g.map(s=>e.jsx("option",{value:s.id,children:s.full_name},s.id))]})]})]})]}),k?e.jsx("div",{className:"bg-slate-800 border border-slate-700 rounded-lg p-12 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400",children:"Loading consultations..."})]})}):t.length===0?e.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-lg p-12 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-slate-700 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(H,{className:"w-8 h-8 text-slate-500"})}),e.jsx("p",{className:"text-slate-400 mb-2",children:o?"No consultations match your filters":"No consultations yet"}),e.jsx("p",{className:"text-sm text-slate-500 mb-4",children:o?"Try adjusting your filter criteria":"Get started by creating your first consultation"}),!o&&e.jsxs("button",{onClick:()=>r("/portal/consultations/new"),className:"inline-flex items-center px-4 py-2 bg-primary hover:bg-opacity-80 text-white rounded-lg transition-colors font-medium",children:[e.jsx(K,{className:"w-5 h-5 mr-2"}),"New Consultation"]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-slate-800 border border-slate-700 rounded-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-900 border-b border-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-300 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-300 uppercase tracking-wider",children:"Patient"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-300 uppercase tracking-wider",children:"Doctor"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-300 uppercase tracking-wider",children:"Chief Complaint"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-300 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-right text-xs font-semibold text-slate-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-700",children:t.map(s=>e.jsxs("tr",{className:"hover:bg-slate-750 transition-colors",children:[e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"text-sm font-medium text-white",children:new Date(s.consultation_date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}),e.jsx("div",{className:"text-xs text-slate-400",children:new Date(s.consultation_date).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})})]}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-slate-300",children:s.patient_name})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-slate-300",children:s.doctor_name})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-slate-300",children:s.chief_complaint?s.chief_complaint.length>50?e.jsxs("span",{title:s.chief_complaint,children:[s.chief_complaint.substring(0,50),"..."]}):s.chief_complaint:e.jsx("span",{className:"text-slate-500",children:"-"})})}),e.jsx("td",{className:"px-6 py-4",children:F(s.status)}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsxs("button",{onClick:()=>r(`/portal/patients/${s.patient_id}`),className:"inline-flex items-center px-3 py-1.5 text-sm font-medium text-blue-300 bg-blue-900 hover:bg-blue-800 border border-blue-700 rounded-lg transition-colors",children:[e.jsx(oe,{className:"w-4 h-4 mr-1"}),"Patient"]}),e.jsxs("button",{onClick:()=>r(`/portal/consultations/${s.id}`),className:"inline-flex items-center px-3 py-1.5 text-sm font-medium text-green-300 bg-green-900 hover:bg-green-800 border border-green-700 rounded-lg transition-colors",children:[e.jsx(Ke,{className:"w-4 h-4 mr-1"}),"Edit"]})]})})]},s.id))})]})})}),v>1&&e.jsxs("div",{className:"flex items-center justify-between bg-slate-800 border border-slate-700 rounded-lg px-6 py-4",children:[e.jsxs("div",{className:"text-sm text-slate-400",children:["Showing ",(u-1)*C+1," to"," ",Math.min(u*C,_)," of ",_," consultations"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>j(s=>Math.max(1,s-1)),disabled:u===1,className:"p-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(be,{className:"w-5 h-5"})}),e.jsxs("span",{className:"text-sm text-slate-300",children:["Page ",u," of ",v]}),e.jsx("button",{onClick:()=>j(s=>Math.min(v,s+1)),disabled:u===v,className:"p-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(fe,{className:"w-5 h-5"})})]})]})]})]})},ke=()=>{const{id:r}=ne(),i=G(),[t]=he(),{organization:a,user:g}=V(),[I,k]=n.useState([]),[w,u]=n.useState([]),[j,_]=n.useState(!1),[U,y]=n.useState(!1),[b,C]=n.useState(""),[T,A]=n.useState(!1),[l,D]=n.useState(null),[v,F]=n.useState({patient_id:t.get("patientId")||"",doctor_id:"",consultation_date:new Date().toISOString().slice(0,16),chief_complaint:"",diagnosis:"",notes:"",status:"scheduled",follow_up_date:""});n.useEffect(()=>{a!=null&&a.id&&(o(),s(),r&&h())},[a==null?void 0:a.id,r]);const o=()=>L(void 0,null,function*(){try{const{data:d,error:p}=yield x.from("patients").select("id, full_name").eq("organization_id",a.id).order("full_name");if(p)throw p;k(d||[])}catch(d){console.error("Error loading patients:",d),q.error("Failed to load patients")}}),s=()=>L(void 0,null,function*(){try{const{data:d,error:p}=yield x.from("org_staff").select("id, user_id").eq("organization_id",a.id).eq("role","doctor");if(p)throw p;const P=yield Promise.all((d||[]).map(S=>L(void 0,null,function*(){const{data:$}=yield x.from("users").select("full_name").eq("id",S.user_id).maybeSingle();return{id:S.id,full_name:($==null?void 0:$.full_name)||"Unknown Doctor"}})));if(u(P),!r&&P.length>0){const S=yield x.from("org_staff").select("id").eq("organization_id",a.id).eq("user_id",g.id).maybeSingle();S.data&&F($=>O(R({},$),{doctor_id:S.data.id}))}}catch(d){console.error("Error loading doctors:",d),q.error("Failed to load doctors")}}),h=()=>L(void 0,null,function*(){try{_(!0);const{data:d,error:p}=yield x.from("consultations").select("*").eq("id",r).eq("organization_id",a.id).maybeSingle();if(p)throw p;if(!d){q.error("Consultation not found"),i("/portal/consultations");return}F({patient_id:d.patient_id,doctor_id:d.doctor_id,consultation_date:d.consultation_date.slice(0,16),chief_complaint:d.chief_complaint||"",diagnosis:d.diagnosis||"",notes:d.notes||"",status:d.status,follow_up_date:d.follow_up_date?d.follow_up_date.slice(0,16):""})}catch(d){console.error("Error loading consultation:",d),q.error("Failed to load consultation")}finally{_(!1)}}),c=d=>L(void 0,null,function*(){if(d.preventDefault(),!v.patient_id){q.error("Please select a patient");return}if(!v.doctor_id){q.error("Please select a doctor");return}if(!v.consultation_date){q.error("Please select a consultation date");return}try{y(!0);const p={organization_id:a.id,patient_id:v.patient_id,doctor_id:v.doctor_id,consultation_date:v.consultation_date,chief_complaint:v.chief_complaint.trim()||null,diagnosis:v.diagnosis.trim()||null,notes:v.notes.trim()||null,status:v.status,follow_up_date:v.follow_up_date||null};if(r){const{error:P}=yield x.from("consultations").update(p).eq("id",r);if(P)throw P;q.success("Consultation updated successfully"),D(r)}else{const{data:P,error:S}=yield x.from("consultations").insert([p]).select().single();if(S)throw S;q.success("Consultation created successfully"),D(P.id)}}catch(p){console.error("Error saving consultation:",p),q.error(p.message||"Failed to save consultation")}finally{y(!1)}}),N=I.filter(d=>d.full_name.toLowerCase().includes(b.toLowerCase())),f=I.find(d=>d.id===v.patient_id);return j?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400",children:"Loading consultation..."})]})}):l?e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-lg p-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-green-900 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(ce,{className:"w-8 h-8 text-green-300"})}),e.jsxs("h2",{className:"text-2xl font-bold text-white mb-2",children:["Consultation ",r?"Updated":"Created"," Successfully"]}),e.jsx("p",{className:"text-slate-400 mb-6",children:"What would you like to do next?"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 max-w-2xl mx-auto",children:[e.jsxs("button",{onClick:()=>i(`/portal/consultations/${l}/prescription`),className:"flex flex-col items-center p-6 bg-slate-900 hover:bg-slate-750 border border-slate-700 hover:border-primary rounded-lg transition-all group",children:[e.jsx("div",{className:"w-12 h-12 bg-green-900 group-hover:bg-primary rounded-full flex items-center justify-center mb-3 transition-colors",children:e.jsx(ie,{className:"w-6 h-6 text-green-300 group-hover:text-white"})}),e.jsx("span",{className:"text-sm font-medium text-white mb-1",children:"Add Prescription"}),e.jsx("span",{className:"text-xs text-slate-400",children:"Create prescription for this visit"})]}),e.jsxs("button",{onClick:()=>i(`/portal/consultations/${l}/lab-order`),className:"flex flex-col items-center p-6 bg-slate-900 hover:bg-slate-750 border border-slate-700 hover:border-primary rounded-lg transition-all group",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-900 group-hover:bg-primary rounded-full flex items-center justify-center mb-3 transition-colors",children:e.jsx(Q,{className:"w-6 h-6 text-purple-300 group-hover:text-white"})}),e.jsx("span",{className:"text-sm font-medium text-white mb-1",children:"Order Lab Tests"}),e.jsx("span",{className:"text-xs text-slate-400",children:"Request lab work for patient"})]}),e.jsxs("button",{onClick:()=>i("/portal/consultations"),className:"flex flex-col items-center p-6 bg-slate-900 hover:bg-slate-750 border border-slate-700 hover:border-primary rounded-lg transition-all group",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-900 group-hover:bg-primary rounded-full flex items-center justify-center mb-3 transition-colors",children:e.jsx(He,{className:"w-6 h-6 text-blue-300 group-hover:text-white"})}),e.jsx("span",{className:"text-sm font-medium text-white mb-1",children:"Back to List"}),e.jsx("span",{className:"text-xs text-slate-400",children:"Return to consultations"})]})]})]})}):e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("button",{onClick:()=>i("/portal/consultations"),className:"inline-flex items-center text-slate-400 hover:text-white transition-colors",children:[e.jsx(se,{className:"w-5 h-5 mr-2"}),"Back to Consultations"]})}),e.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"bg-slate-900 border-b border-slate-700 px-6 py-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-white",children:r?"Edit Consultation":"New Consultation"}),e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:r?"Update consultation details":"Create a new patient consultation"})]}),e.jsxs("form",{onSubmit:c,className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:["Patient ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:(f==null?void 0:f.full_name)||b,onChange:d=>{C(d.target.value),A(!0)},onFocus:()=>A(!0),placeholder:"Search patient by name...",className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary",required:!0}),T&&N.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>A(!1)}),e.jsx("div",{className:"absolute z-20 w-full mt-1 bg-slate-900 border border-slate-700 rounded-lg shadow-xl max-h-60 overflow-y-auto",children:N.map(d=>e.jsx("button",{type:"button",onClick:()=>{F(O(R({},v),{patient_id:d.id})),C(""),A(!1)},className:"w-full px-4 py-3 text-left text-sm text-white hover:bg-slate-800 transition-colors",children:d.full_name},d.id))})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:["Doctor ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsxs("select",{value:v.doctor_id,onChange:d=>F(O(R({},v),{doctor_id:d.target.value})),className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary",required:!0,children:[e.jsx("option",{value:"",children:"Select doctor"}),w.map(d=>e.jsx("option",{value:d.id,children:d.full_name},d.id))]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:["Consultation Date & Time ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("input",{type:"datetime-local",value:v.consultation_date,onChange:d=>F(O(R({},v),{consultation_date:d.target.value})),className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Status"}),e.jsxs("select",{value:v.status,onChange:d=>F(O(R({},v),{status:d.target.value})),className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary",children:[e.jsx("option",{value:"scheduled",children:"Scheduled"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Chief Complaint"}),e.jsx("textarea",{value:v.chief_complaint,onChange:d=>F(O(R({},v),{chief_complaint:d.target.value})),rows:3,placeholder:"Enter patient's main complaint or reason for visit...",className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Diagnosis"}),e.jsx("textarea",{value:v.diagnosis,onChange:d=>F(O(R({},v),{diagnosis:d.target.value})),rows:3,placeholder:"Enter diagnosis or assessment...",className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Clinical Notes"}),e.jsx("textarea",{value:v.notes,onChange:d=>F(O(R({},v),{notes:d.target.value})),rows:5,placeholder:"Enter detailed clinical notes, observations, treatment plan, etc...",className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Follow-up Date (Optional)"}),e.jsx("input",{type:"datetime-local",value:v.follow_up_date,onChange:d=>F(O(R({},v),{follow_up_date:d.target.value})),className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary"})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t border-slate-700",children:[e.jsx("button",{type:"button",onClick:()=>i("/portal/consultations"),className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors",disabled:U,children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:U,className:"inline-flex items-center px-4 py-2 bg-primary hover:bg-opacity-80 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),U?"Saving...":r?"Update Consultation":"Create Consultation"]})]})]})]})]})},Ss=()=>{const r=G(),[i]=he(),t=i.get("consultationId"),{organization:a,user:g}=V(),[I,k]=n.useState(!0),[w,u]=n.useState(!1),[j,_]=n.useState(null),[U,y]=n.useState([]),[b,C]=n.useState(""),[T,A]=n.useState(""),[l,D]=n.useState(new Date().toISOString().split("T")[0]),[v,F]=n.useState(""),[o,s]=n.useState([{medicine_name:"",dosage:"",frequency:"",duration:"",instructions:""}]);n.useEffect(()=>{a!=null&&a.id&&h()},[a==null?void 0:a.id,t]);const h=()=>L(void 0,null,function*(){try{k(!0);const{data:p,error:P}=yield x.from("org_staff").select("id, user_id").eq("organization_id",a.id).eq("role","doctor");if(P)throw P;const S=yield Promise.all((p||[]).map(m=>L(void 0,null,function*(){const{data:E}=yield x.from("users").select("full_name").eq("id",m.user_id).maybeSingle();return{id:m.id,full_name:(E==null?void 0:E.full_name)||"Unknown Doctor"}})));y(S);const $=yield x.from("org_staff").select("id").eq("organization_id",a.id).eq("user_id",g.id).maybeSingle();if($.data&&A($.data.id),t){const{data:m,error:E}=yield x.from("consultations").select("patient_id, doctor_id").eq("id",t).eq("organization_id",a.id).maybeSingle();if(E)throw E;if(m){C(m.patient_id),A(m.doctor_id);const{data:M,error:B}=yield x.from("patients").select("id, full_name, age, gender").eq("id",m.patient_id).maybeSingle();if(B)throw B;_(M)}}}catch(p){console.error("Error loading data:",p),q.error("Failed to load data")}finally{k(!1)}}),c=()=>{s([...o,{medicine_name:"",dosage:"",frequency:"",duration:"",instructions:""}])},N=p=>{o.length>1?s(o.filter((P,S)=>S!==p)):q.error("At least one medicine is required")},f=(p,P,S)=>{const $=[...o];$[p][P]=S,s($)},d=p=>L(void 0,null,function*(){if(p.preventDefault(),!b){q.error("Patient information is required");return}if(!T){q.error("Please select a doctor");return}const P=o.filter(S=>S.medicine_name.trim());if(P.length===0){q.error("Please add at least one medicine");return}try{u(!0);const S={organization_id:a.id,patient_id:b,doctor_id:T,prescription_date:l,notes:v.trim()||null},{data:$,error:m}=yield x.from("prescriptions").insert([S]).select().single();if(m)throw m;const E=P.map(B=>({prescription_id:$.id,medicine_name:B.medicine_name.trim(),dosage:B.dosage.trim()||null,frequency:B.frequency.trim()||null,duration:B.duration.trim()||null,instructions:B.instructions.trim()||null})),{error:M}=yield x.from("prescription_items").insert(E);if(M)throw M;q.success("Prescription created successfully"),r(t?`/portal/patients/${b}`:`/portal/prescriptions/${$.id}`)}catch(S){console.error("Error creating prescription:",S),q.error(S.message||"Failed to create prescription")}finally{u(!1)}});return I?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400",children:"Loading..."})]})}):e.jsxs("div",{className:"max-w-5xl mx-auto space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("button",{onClick:()=>r(-1),className:"inline-flex items-center text-slate-400 hover:text-white transition-colors",children:[e.jsx(se,{className:"w-5 h-5 mr-2"}),"Back"]})}),e.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"bg-slate-900 border-b border-slate-700 px-6 py-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-white",children:"New Prescription"}),e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:"Create a new prescription for the patient"})]}),e.jsxs("form",{onSubmit:d,className:"p-6 space-y-6",children:[j&&e.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-lg p-4",children:[e.jsx("div",{className:"text-xs text-slate-500 uppercase tracking-wider mb-3",children:"Patient Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(X,{className:"w-5 h-5 text-slate-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Name"}),e.jsx("div",{className:"text-sm font-medium text-white",children:j.full_name})]})]}),j.age&&e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(H,{className:"w-5 h-5 text-slate-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Age"}),e.jsxs("div",{className:"text-sm font-medium text-white",children:[j.age," years"]})]})]}),j.gender&&e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(X,{className:"w-5 h-5 text-slate-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Gender"}),e.jsx("div",{className:"text-sm font-medium text-white",children:j.gender.charAt(0).toUpperCase()+j.gender.slice(1)})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:["Doctor ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsxs("select",{value:T,onChange:p=>A(p.target.value),className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary",required:!0,children:[e.jsx("option",{value:"",children:"Select doctor"}),U.map(p=>e.jsx("option",{value:p.id,children:p.full_name},p.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:["Prescription Date ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("input",{type:"date",value:l,onChange:p=>D(p.target.value),className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Prescription Notes"}),e.jsx("textarea",{value:v,onChange:p=>F(p.target.value),rows:3,placeholder:"Enter any special instructions or notes for the prescription...",className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary resize-none"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-white",children:["Medicines ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Add at least one medicine"})]}),e.jsxs("button",{type:"button",onClick:c,className:"inline-flex items-center px-3 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors text-sm",children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"Add Medicine"]})]}),e.jsx("div",{className:"space-y-4",children:o.map((p,P)=>e.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("span",{className:"text-sm font-medium text-white",children:["Medicine #",P+1]}),o.length>1&&e.jsx("button",{type:"button",onClick:()=>N(P),className:"text-red-400 hover:text-red-300 transition-colors",children:e.jsx(Ye,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-xs text-slate-400 mb-2",children:["Medicine Name ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("input",{type:"text",value:p.medicine_name,onChange:S=>f(P,"medicine_name",S.target.value),placeholder:"e.g., Amoxicillin 500mg",className:"w-full px-3 py-2 bg-slate-800 border border-slate-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary text-sm",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-400 mb-2",children:"Dosage"}),e.jsx("input",{type:"text",value:p.dosage,onChange:S=>f(P,"dosage",S.target.value),placeholder:"e.g., 1 tablet",className:"w-full px-3 py-2 bg-slate-800 border border-slate-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-400 mb-2",children:"Frequency"}),e.jsx("input",{type:"text",value:p.frequency,onChange:S=>f(P,"frequency",S.target.value),placeholder:"e.g., 3 times daily",className:"w-full px-3 py-2 bg-slate-800 border border-slate-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-400 mb-2",children:"Duration"}),e.jsx("input",{type:"text",value:p.duration,onChange:S=>f(P,"duration",S.target.value),placeholder:"e.g., 7 days",className:"w-full px-3 py-2 bg-slate-800 border border-slate-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-400 mb-2",children:"Instructions"}),e.jsx("input",{type:"text",value:p.instructions,onChange:S=>f(P,"instructions",S.target.value),placeholder:"e.g., After meals",className:"w-full px-3 py-2 bg-slate-800 border border-slate-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary text-sm"})]})]})]},P))})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t border-slate-700",children:[e.jsx("button",{type:"button",onClick:()=>r(-1),className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors",disabled:w,children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:w,className:"inline-flex items-center px-4 py-2 bg-primary hover:bg-opacity-80 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),w?"Creating...":"Create Prescription"]})]})]})]})]})},Cs=()=>{const{id:r}=ne(),i=G(),{organization:t}=V(),[a,g]=n.useState(!0),[I,k]=n.useState(null),[w,u]=n.useState([]),[j,_]=n.useState(null),[U,y]=n.useState(null),[b,C]=n.useState(null);n.useEffect(()=>{r&&(t!=null&&t.id)&&T()},[r,t==null?void 0:t.id]);const T=()=>L(void 0,null,function*(){var l;try{g(!0);const{data:D,error:v}=yield x.from("prescriptions").select("*").eq("id",r).eq("organization_id",t.id).maybeSingle();if(v)throw v;if(!D){q.error("Prescription not found"),i("/portal/patients");return}k(D);const[F,o,s,h]=yield Promise.all([x.from("prescription_items").select("*").eq("prescription_id",r).order("created_at"),x.from("patients").select("full_name, age, gender, phone, address").eq("id",D.patient_id).maybeSingle(),x.from("org_staff").select("user_id").eq("id",D.doctor_id).maybeSingle(),x.from("organizations").select("name").eq("id",t.id).maybeSingle()]);if(F.error)throw F.error;if(o.error)throw o.error;if(h.error)throw h.error;if(u(F.data||[]),_(o.data),C(h.data),(l=s.data)!=null&&l.user_id){const{data:c}=yield x.from("users").select("full_name").eq("id",s.data.user_id).maybeSingle();y(c||{full_name:"Unknown Doctor"})}}catch(D){console.error("Error loading prescription:",D),q.error("Failed to load prescription")}finally{g(!1)}}),A=()=>{window.print()};return a?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400",children:"Loading prescription..."})]})}):!I||!j||!U?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-slate-400",children:"Prescription not found"})}):e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between print:hidden",children:[e.jsxs("button",{onClick:()=>i(-1),className:"inline-flex items-center text-slate-400 hover:text-white transition-colors",children:[e.jsx(se,{className:"w-5 h-5 mr-2"}),"Back"]}),e.jsxs("button",{onClick:A,className:"inline-flex items-center px-4 py-2 bg-primary hover:bg-opacity-80 text-white rounded-lg transition-colors",children:[e.jsx(Je,{className:"w-5 h-5 mr-2"}),"Print"]})]}),e.jsxs("div",{className:"bg-white text-slate-900 rounded-lg shadow-lg overflow-hidden print:shadow-none",children:[e.jsxs("div",{className:"border-b-2 border-slate-900 p-8",children:[e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsx("div",{children:e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("div",{className:"w-12 h-12 bg-primary rounded-full flex items-center justify-center",children:e.jsx(ie,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:(b==null?void 0:b.name)||"Medical Clinic"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Medical Prescription"})]})]})}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-slate-600 uppercase tracking-wider mb-1",children:"Prescription ID"}),e.jsx("div",{className:"text-sm font-mono text-slate-900",children:I.id.slice(0,8)}),e.jsxs("div",{className:"text-xs text-slate-600 mt-2",children:["Date: ",new Date(I.prescription_date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-600 uppercase tracking-wider mb-2 font-semibold",children:"Patient Information"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Name:"})," ",j.full_name]}),j.age&&e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Age:"})," ",j.age," years"]}),j.gender&&e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Gender:"})," ",j.gender.charAt(0).toUpperCase()+j.gender.slice(1)]}),j.phone&&e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Phone:"})," ",j.phone]}),j.address&&e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Address:"})," ",j.address]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-600 uppercase tracking-wider mb-2 font-semibold",children:"Prescribing Doctor"}),e.jsx("div",{className:"space-y-1",children:e.jsx("div",{className:"text-sm",children:e.jsxs("span",{className:"font-semibold",children:["Dr. ",U.full_name]})})})]})]})]}),e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx("div",{className:"w-8 h-8 bg-primary bg-opacity-10 rounded flex items-center justify-center",children:e.jsx("span",{className:"text-primary font-bold",children:"Rx"})}),e.jsx("h2",{className:"text-lg font-bold text-slate-900",children:"Prescription"})]}),e.jsx("div",{className:"space-y-4",children:w.map((l,D)=>e.jsx("div",{className:"border border-slate-300 rounded-lg p-4 bg-slate-50",children:e.jsx("div",{className:"flex items-start justify-between mb-2",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-semibold text-slate-900 text-base mb-1",children:[D+1,". ",l.medicine_name]}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1 text-sm text-slate-700",children:[l.dosage&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Dosage:"})," ",l.dosage]}),l.frequency&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Frequency:"})," ",l.frequency]}),l.duration&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Duration:"})," ",l.duration]}),l.instructions&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"font-medium",children:"Instructions:"})," ",l.instructions]})]})]})})},l.id))})]}),I.notes&&e.jsxs("div",{className:"border-t border-slate-300 pt-6 mt-6",children:[e.jsx("div",{className:"text-xs text-slate-600 uppercase tracking-wider mb-2 font-semibold",children:"Additional Notes"}),e.jsx("p",{className:"text-sm text-slate-700 whitespace-pre-wrap",children:I.notes})]}),e.jsx("div",{className:"border-t border-slate-300 pt-8 mt-8",children:e.jsxs("div",{className:"flex items-end justify-between",children:[e.jsxs("div",{className:"text-xs text-slate-600",children:[e.jsx("p",{children:"This is a computer-generated prescription."}),e.jsx("p",{className:"mt-1",children:"Valid for 30 days from date of issue."})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"w-48 border-t-2 border-slate-900 pt-2",children:[e.jsxs("div",{className:"text-sm font-semibold text-slate-900",children:["Dr. ",U.full_name]}),e.jsx("div",{className:"text-xs text-slate-600",children:"Authorized Signature"})]})})]})})]}),e.jsxs("div",{className:"bg-slate-900 text-white px-8 py-4 text-center text-xs",children:[e.jsx("p",{children:(b==null?void 0:b.name)||"Medical Clinic"}),e.jsx("p",{className:"mt-1 text-slate-400",children:"For any queries, please contact your healthcare provider"})]})]})]})},Pe=()=>{const r=G(),[i]=he(),t=i.get("consultationId"),{organization:a,user:g}=V(),[I,k]=n.useState(!0),[w,u]=n.useState(!1),[j,_]=n.useState(null),[U,y]=n.useState(""),[b,C]=n.useState([]),[T,A]=n.useState([]),[l,D]=n.useState([]),[v,F]=n.useState(""),[o,s]=n.useState(""),[h,c]=n.useState(""),[N,f]=n.useState(!1);n.useEffect(()=>{a!=null&&a.id&&d()},[a==null?void 0:a.id,t]);const d=()=>L(void 0,null,function*(){var m;try{k(!0);const[E,M]=yield Promise.all([x.from("patients").select("id, full_name, age, gender").eq("organization_id",a.id).order("full_name"),x.from("lab_tests").select("id, name, code, description").eq("is_active",!0).or(`organization_id.is.null,organization_id.eq.${a.id}`).order("name")]);if(E.error)throw E.error;if(M.error)throw M.error;C(E.data||[]),A(M.data||[]);const B=yield x.from("org_staff").select("id").eq("organization_id",a.id).eq("user_id",g.id).maybeSingle();if(B.data&&F(B.data.id),t){const{data:z,error:Y}=yield x.from("consultations").select("patient_id, doctor_id").eq("id",t).eq("organization_id",a.id).maybeSingle();if(Y)throw Y;if(z){y(z.patient_id),F(z.doctor_id);const J=(m=E.data)==null?void 0:m.find(ae=>ae.id===z.patient_id);_(J||null)}}}catch(E){console.error("Error loading data:",E),q.error("Failed to load data")}finally{k(!1)}}),p=m=>{D(E=>E.includes(m)?E.filter(M=>M!==m):[...E,m])},P=m=>L(void 0,null,function*(){if(m.preventDefault(),!U){q.error("Please select a patient");return}if(!v){q.error("Doctor information is required");return}if(l.length===0){q.error("Please select at least one lab test");return}try{u(!0);const E=T.filter(Y=>l.includes(Y.id)).map(Y=>Y.name).join(", "),M={organization_id:a.id,patient_id:U,doctor_id:v,test_ids:l,test_names:E,status:"pending",special_instructions:o.trim()||null},{data:B,error:z}=yield x.from("lab_orders").insert([M]).select().single();if(z)throw z;q.success("Lab order created successfully"),r(t?`/portal/patients/${U}`:"/portal/lab-orders")}catch(E){console.error("Error creating lab order:",E),q.error(E.message||"Failed to create lab order")}finally{u(!1)}}),S=b.filter(m=>m.full_name.toLowerCase().includes(h.toLowerCase())),$=b.find(m=>m.id===U);return I?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400",children:"Loading..."})]})}):e.jsxs("div",{className:"max-w-5xl mx-auto space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("button",{onClick:()=>r(-1),className:"inline-flex items-center text-slate-400 hover:text-white transition-colors",children:[e.jsx(se,{className:"w-5 h-5 mr-2"}),"Back"]})}),e.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"bg-slate-900 border-b border-slate-700 px-6 py-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-white",children:"New Lab Order"}),e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:"Order laboratory tests for a patient"})]}),e.jsxs("form",{onSubmit:P,className:"p-6 space-y-6",children:[j?e.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-lg p-4",children:[e.jsx("div",{className:"text-xs text-slate-500 uppercase tracking-wider mb-3",children:"Patient Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Name"}),e.jsx("div",{className:"text-sm font-medium text-white",children:j.full_name})]}),j.age&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Age"}),e.jsxs("div",{className:"text-sm font-medium text-white",children:[j.age," years"]})]}),j.gender&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Gender"}),e.jsx("div",{className:"text-sm font-medium text-white",children:j.gender.charAt(0).toUpperCase()+j.gender.slice(1)})]})]})]}):e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:["Patient ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:($==null?void 0:$.full_name)||h,onChange:m=>{c(m.target.value),f(!0)},onFocus:()=>f(!0),placeholder:"Search patient by name...",className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary",required:!0}),N&&S.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>f(!1)}),e.jsx("div",{className:"absolute z-20 w-full mt-1 bg-slate-900 border border-slate-700 rounded-lg shadow-xl max-h-60 overflow-y-auto",children:S.map(m=>e.jsx("button",{type:"button",onClick:()=>{y(m.id),_(m),c(""),f(!1)},className:"w-full px-4 py-3 text-left text-sm text-white hover:bg-slate-800 transition-colors",children:m.full_name},m.id))})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-white",children:["Select Lab Tests ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Choose one or more tests to order"})]}),e.jsxs("span",{className:"text-sm text-slate-400",children:[l.length," test(s) selected"]})]}),T.length===0?e.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-lg p-8 text-center",children:[e.jsx(Q,{className:"w-12 h-12 text-slate-600 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-400",children:"No lab tests available"}),e.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"Please contact your administrator to add lab tests"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:T.map(m=>e.jsxs("label",{className:`flex items-start space-x-3 p-4 border-2 rounded-lg cursor-pointer transition-all ${l.includes(m.id)?"border-primary bg-primary bg-opacity-10":"border-slate-700 bg-slate-900 hover:border-slate-600"}`,children:[e.jsx("input",{type:"checkbox",checked:l.includes(m.id),onChange:()=>p(m.id),className:"mt-1 w-5 h-5 text-primary bg-slate-800 border-slate-600 rounded focus:ring-primary focus:ring-2"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-medium text-white",children:m.name}),m.code&&e.jsx("span",{className:"text-xs text-slate-400 bg-slate-800 px-2 py-0.5 rounded",children:m.code})]}),m.description&&e.jsx("p",{className:"text-xs text-slate-400 mt-1 line-clamp-2",children:m.description})]})]},m.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Special Instructions"}),e.jsx("textarea",{value:o,onChange:m=>s(m.target.value),rows:4,placeholder:"Enter any special instructions for the lab tests (e.g., fasting required, timing requirements, etc.)...",className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary resize-none"})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t border-slate-700",children:[e.jsx("button",{type:"button",onClick:()=>r(-1),className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors",disabled:w,children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:w||l.length===0,className:"inline-flex items-center px-4 py-2 bg-primary hover:bg-opacity-80 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),w?"Creating...":"Create Lab Order"]})]})]})]})]})},ks=()=>{const r=G(),{organization:i}=V(),[t,a]=n.useState([]),[g,I]=n.useState(!0),[k,w]=n.useState(1),[u,j]=n.useState(0),[_,U]=n.useState(""),y=20;n.useEffect(()=>{i!=null&&i.id&&b()},[i==null?void 0:i.id,k,_]);const b=()=>L(void 0,null,function*(){try{I(!0);let l=x.from("lab_orders").select("*",{count:"exact"}).eq("organization_id",i.id).order("created_at",{ascending:!1});_&&(l=l.eq("status",_));const D=(k-1)*y,v=D+y-1,{data:F,error:o,count:s}=yield l.range(D,v);if(o)throw o;const h=yield Promise.all((F||[]).map(c=>L(void 0,null,function*(){var P,S;const[N,f,d]=yield Promise.all([x.from("patients").select("full_name").eq("id",c.patient_id).maybeSingle(),x.from("org_staff").select("user_id").eq("id",c.doctor_id).maybeSingle(),x.from("lab_reports").select("id").eq("lab_order_id",c.id).maybeSingle()]);let p="Unknown";if((P=f.data)!=null&&P.user_id){const{data:$}=yield x.from("users").select("full_name").eq("id",f.data.user_id).maybeSingle();p=($==null?void 0:$.full_name)||"Unknown"}return O(R({},c),{patient_name:((S=N.data)==null?void 0:S.full_name)||"Unknown Patient",doctor_name:p,has_report:!!d.data})})));a(h),j(s||0)}catch(l){console.error("Error loading lab orders:",l),q.error("Failed to load lab orders")}finally{I(!1)}}),C=Math.ceil(u/y),T=l=>{const D={pending:"bg-amber-900 text-amber-300 border-amber-700",completed:"bg-green-900 text-green-300 border-green-700",cancelled:"bg-red-900 text-red-300 border-red-700"};return e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded border ${D[l]||D.pending}`,children:l.charAt(0).toUpperCase()+l.slice(1)})},A=!!_;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Lab Orders"}),e.jsx("p",{className:"text-slate-400",children:"Manage laboratory test orders and reports"})]}),e.jsxs("button",{onClick:()=>r("/portal/lab-orders/new"),className:"inline-flex items-center px-4 py-2 bg-primary hover:bg-opacity-80 text-white rounded-lg transition-colors font-medium",children:[e.jsx(K,{className:"w-5 h-5 mr-2"}),"New Lab Order"]})]}),e.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(ge,{className:"w-5 h-5 text-slate-400"}),e.jsx("span",{className:"text-sm font-medium text-white",children:"Filters"}),A&&e.jsx("button",{onClick:()=>{U(""),w(1)},className:"text-xs text-primary hover:text-opacity-80 ml-auto",children:"Clear All"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-400 mb-2",children:"Status"}),e.jsxs("select",{value:_,onChange:l=>{U(l.target.value),w(1)},className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary text-sm",children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]})})]}),g?e.jsx("div",{className:"bg-slate-800 border border-slate-700 rounded-lg p-12 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400",children:"Loading lab orders..."})]})}):t.length===0?e.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-lg p-12 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-slate-700 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Q,{className:"w-8 h-8 text-slate-500"})}),e.jsx("p",{className:"text-slate-400 mb-2",children:A?"No lab orders match your filters":"No lab orders yet"}),e.jsx("p",{className:"text-sm text-slate-500 mb-4",children:A?"Try adjusting your filter criteria":"Get started by creating your first lab order"}),!A&&e.jsxs("button",{onClick:()=>r("/portal/lab-orders/new"),className:"inline-flex items-center px-4 py-2 bg-primary hover:bg-opacity-80 text-white rounded-lg transition-colors font-medium",children:[e.jsx(K,{className:"w-5 h-5 mr-2"}),"New Lab Order"]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-slate-800 border border-slate-700 rounded-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-900 border-b border-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-300 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-300 uppercase tracking-wider",children:"Patient"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-300 uppercase tracking-wider",children:"Tests"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-300 uppercase tracking-wider",children:"Ordered By"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-300 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-right text-xs font-semibold text-slate-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-700",children:t.map(l=>e.jsxs("tr",{className:"hover:bg-slate-750 transition-colors",children:[e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"text-sm font-medium text-white",children:new Date(l.created_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}),e.jsx("div",{className:"text-xs text-slate-400",children:new Date(l.created_at).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})})]}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-slate-300",children:l.patient_name})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-slate-300",children:l.test_names.length>50?e.jsxs("span",{title:l.test_names,children:[l.test_names.substring(0,50),"..."]}):l.test_names})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-slate-300",children:l.doctor_name})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[T(l.status),l.has_report&&e.jsx("span",{className:"text-xs text-green-400",children:"Report Available"})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsxs("button",{onClick:()=>r(`/portal/patients/${l.patient_id}`),className:"inline-flex items-center px-3 py-1.5 text-sm font-medium text-blue-300 bg-blue-900 hover:bg-blue-800 border border-blue-700 rounded-lg transition-colors",children:[e.jsx(oe,{className:"w-4 h-4 mr-1"}),"Patient"]}),l.status==="pending"&&!l.has_report&&e.jsxs("button",{onClick:()=>r(`/portal/lab-orders/${l.id}/upload`),className:"inline-flex items-center px-3 py-1.5 text-sm font-medium text-green-300 bg-green-900 hover:bg-green-800 border border-green-700 rounded-lg transition-colors",children:[e.jsx(Xe,{className:"w-4 h-4 mr-1"}),"Upload Report"]})]})})]},l.id))})]})})}),C>1&&e.jsxs("div",{className:"flex items-center justify-between bg-slate-800 border border-slate-700 rounded-lg px-6 py-4",children:[e.jsxs("div",{className:"text-sm text-slate-400",children:["Showing ",(k-1)*y+1," to"," ",Math.min(k*y,u)," of ",u," lab orders"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>w(l=>Math.max(1,l-1)),disabled:k===1,className:"p-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(be,{className:"w-5 h-5"})}),e.jsxs("span",{className:"text-sm text-slate-300",children:["Page ",k," of ",C]}),e.jsx("button",{onClick:()=>w(l=>Math.min(C,l+1)),disabled:k===C,className:"p-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(fe,{className:"w-5 h-5"})})]})]})]})]})},Ps=()=>{const{id:r}=ne(),i=G(),{organization:t,user:a}=V(),[g,I]=n.useState(!0),[k,w]=n.useState(!1),[u,j]=n.useState(null),[_,U]=n.useState(""),[y,b]=n.useState(""),[C,T]=n.useState(""),[A,l]=n.useState(!1);n.useEffect(()=>{r&&(t!=null&&t.id)&&D()},[r,t==null?void 0:t.id]);const D=()=>L(void 0,null,function*(){try{I(!0);const{data:o,error:s}=yield x.from("lab_orders").select("*").eq("id",r).eq("organization_id",t.id).maybeSingle();if(s)throw s;if(!o){q.error("Lab order not found"),i("/portal/lab-orders");return}const{data:h}=yield x.from("lab_order_tests").select("lab_tests(name)").eq("lab_order_id",r),c=(h==null?void 0:h.map(f=>{var d;return(d=f.lab_tests)==null?void 0:d.name}).filter(Boolean).join(", "))||"No tests",{data:N}=yield x.from("patients").select("full_name").eq("id",o.patient_id).maybeSingle();j(O(R({},o),{test_names:c,patient_name:(N==null?void 0:N.full_name)||"Unknown Patient"}))}catch(o){console.error("Error loading lab order:",o),q.error("Failed to load lab order")}finally{I(!1)}}),v=(o,s)=>{U(o),b(s)},F=()=>L(void 0,null,function*(){if(!_||!y){q.error("Please upload a file first");return}try{w(!0);const{data:o}=yield x.from("org_staff").select("id").eq("organization_id",t.id).eq("user_id",a.id).maybeSingle();if(!o)throw new Error("Staff information not found");const{error:s}=yield x.from("lab_reports").insert([{lab_order_id:r,file_path:y,report_file_url:_,uploaded_by:o.id,notes:C.trim()||null}]);if(s)throw s;const{error:h}=yield x.from("lab_orders").update({status:"completed"}).eq("id",r);if(h)throw h;l(!0),q.success("Lab report saved successfully")}catch(o){console.error("Error saving report:",o),q.error(o.message||"Failed to save lab report")}finally{w(!1)}});return g?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400",children:"Loading..."})]})}):u?A?e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-lg p-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-green-900 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(De,{className:"w-8 h-8 text-green-300"})}),e.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Report Uploaded Successfully"}),e.jsx("p",{className:"text-slate-400 mb-6",children:"The lab report has been uploaded and the order status has been updated to completed."}),e.jsxs("div",{className:"flex items-center justify-center space-x-3",children:[e.jsx("button",{onClick:()=>i("/portal/lab-orders"),className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors",children:"Back to Lab Orders"}),e.jsx("button",{onClick:()=>i(`/portal/patients/${u.patient_id}`),className:"px-4 py-2 bg-primary hover:bg-opacity-80 text-white rounded-lg transition-colors",children:"View Patient"})]})]})}):e.jsxs("div",{className:"max-w-3xl mx-auto space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("button",{onClick:()=>i("/portal/lab-orders"),className:"inline-flex items-center text-slate-400 hover:text-white transition-colors",children:[e.jsx(se,{className:"w-5 h-5 mr-2"}),"Back to Lab Orders"]})}),e.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"bg-slate-900 border-b border-slate-700 px-6 py-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-white",children:"Upload Lab Report"}),e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:"Upload the lab test results for this order"})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-lg p-4",children:[e.jsx("div",{className:"text-xs text-slate-500 uppercase tracking-wider mb-3",children:"Lab Order Details"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Patient"}),e.jsx("div",{className:"text-sm font-medium text-white text-right",children:u.patient_name})]}),e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Tests Ordered"}),e.jsx("div",{className:"text-sm font-medium text-white text-right max-w-md",children:u.test_names})]}),u.special_instructions&&e.jsxs("div",{className:"pt-2 border-t border-slate-700",children:[e.jsx("div",{className:"text-xs text-slate-500 mb-1",children:"Special Instructions"}),e.jsx("div",{className:"text-sm text-slate-300",children:u.special_instructions})]})]})]}),e.jsx(xs,{bucket:"lab-reports",folder:t.id,onUploadComplete:v,acceptedFileTypes:"image/*,application/pdf",maxSizeMB:10,label:"Upload Report File *",description:"PDF or Image files"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Notes"}),e.jsx("textarea",{value:C,onChange:o=>T(o.target.value),rows:4,placeholder:"Add any notes about the lab report...",className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary resize-none"})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t border-slate-700",children:[e.jsx("button",{type:"button",onClick:()=>i("/portal/lab-orders"),className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors",disabled:k,children:"Cancel"}),e.jsx("button",{onClick:F,disabled:!_||k,className:"px-4 py-2 bg-primary hover:bg-opacity-80 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:k?"Saving...":"Save Report"})]})]})]})]}):e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-slate-400",children:"Lab order not found"})})},qs=()=>{const r=G(),{organization:i}=V(),[t,a]=n.useState([]),[g,I]=n.useState(!0),[k,w]=n.useState(!1),[u,j]=n.useState([]),[_,U]=n.useState(""),[y,b]=n.useState(""),[C,T]=n.useState(!1);n.useEffect(()=>{i!=null&&i.id&&(A(),l())},[i==null?void 0:i.id]);const A=()=>L(void 0,null,function*(){try{I(!0);const{data:s,error:h}=yield x.from("chat_sessions").select("*").eq("organization_id",i.id).order("updated_at",{ascending:!1});if(h)throw h;const c=yield Promise.all((s||[]).map(N=>L(void 0,null,function*(){var P,S,$;const[f,d]=yield Promise.all([x.from("patients").select("full_name").eq("id",N.patient_id).maybeSingle(),x.from("messages").select("content, created_at").eq("chat_session_id",N.id).order("created_at",{ascending:!1}).limit(1).maybeSingle()]),p=Math.floor(Math.random()*5);return O(R({},N),{patient_name:((P=f.data)==null?void 0:P.full_name)||"Unknown Patient",last_message:((S=d.data)==null?void 0:S.content)||"No messages yet",last_message_time:(($=d.data)==null?void 0:$.created_at)||N.created_at,unread_count:p})})));a(c)}catch(s){console.error("Error loading chat sessions:",s),q.error("Failed to load chat sessions")}finally{I(!1)}}),l=()=>L(void 0,null,function*(){try{const{data:s,error:h}=yield x.from("patients").select("id, full_name").eq("organization_id",i.id).order("full_name");if(h)throw h;j(s||[])}catch(s){console.error("Error loading patients:",s)}}),D=()=>L(void 0,null,function*(){if(!_){q.error("Please select a patient");return}if(!y.trim()){q.error("Please enter an initial message");return}try{T(!0);const{data:s,error:h}=yield x.from("chat_sessions").insert([{organization_id:i.id,patient_id:_,status:"active"}]).select().single();if(h)throw h;const{error:c}=yield x.from("messages").insert([{chat_session_id:s.id,sender_type:"patient",sender_id:_,content:y.trim()}]);if(c)throw c;q.success("Chat session created successfully"),w(!1),U(""),b(""),r(`/portal/chat/${s.id}`)}catch(s){console.error("Error creating chat session:",s),q.error(s.message||"Failed to create chat session")}finally{T(!1)}}),v=s=>{const h={active:"bg-blue-900 text-blue-300 border-blue-700",escalated:"bg-amber-900 text-amber-300 border-amber-700",resolved:"bg-green-900 text-green-300 border-green-700"};return e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded border ${h[s]||h.active}`,children:s.charAt(0).toUpperCase()+s.slice(1)})},F=s=>{const h=new Date,c=new Date(s),N=Math.floor((h.getTime()-c.getTime())/1e3);return N<60?"Just now":N<3600?`${Math.floor(N/60)}m ago`:N<86400?`${Math.floor(N/3600)}h ago`:N<604800?`${Math.floor(N/86400)}d ago`:c.toLocaleDateString("en-US",{month:"short",day:"numeric"})},o={active:t.filter(s=>s.status==="active"),escalated:t.filter(s=>s.status==="escalated"),resolved:t.filter(s=>s.status==="resolved")};return g?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400",children:"Loading chat sessions..."})]})}):e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Chat Sessions"}),e.jsx("p",{className:"text-slate-400",children:"Manage patient conversations and support requests"})]}),e.jsxs("button",{onClick:()=>w(!0),className:"inline-flex items-center px-4 py-2 bg-primary hover:bg-opacity-80 text-white rounded-lg transition-colors font-medium",children:[e.jsx(K,{className:"w-5 h-5 mr-2"}),"Simulate New Chat"]})]}),t.length===0?e.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-lg p-12 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-slate-700 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(me,{className:"w-8 h-8 text-slate-500"})}),e.jsx("p",{className:"text-slate-400 mb-2",children:"No chat sessions yet"}),e.jsx("p",{className:"text-sm text-slate-500 mb-4",children:"Create a simulated chat to get started"}),e.jsxs("button",{onClick:()=>w(!0),className:"inline-flex items-center px-4 py-2 bg-primary hover:bg-opacity-80 text-white rounded-lg transition-colors font-medium",children:[e.jsx(K,{className:"w-5 h-5 mr-2"}),"Simulate New Chat"]})]}):e.jsxs("div",{className:"space-y-6",children:[o.active.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(te,{className:"w-5 h-5 text-blue-400"}),e.jsxs("h2",{className:"text-lg font-semibold text-white",children:["Active Conversations (",o.active.length,")"]})]}),e.jsx("div",{className:"space-y-2",children:o.active.map(s=>{var h;return e.jsx("button",{onClick:()=>r(`/portal/chat/${s.id}`),className:"w-full bg-slate-800 hover:bg-slate-750 border border-slate-700 rounded-lg p-4 transition-all text-left group",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-primary rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-white font-semibold text-sm",children:(h=s.patient_name)==null?void 0:h.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h3",{className:"text-sm font-semibold text-white truncate",children:s.patient_name}),s.unread_count>0&&e.jsx("span",{className:"inline-flex items-center justify-center w-5 h-5 text-xs font-bold text-white bg-primary rounded-full",children:s.unread_count})]}),e.jsx("p",{className:"text-xs text-slate-400 truncate",children:s.last_message})]})]})}),e.jsxs("div",{className:"flex flex-col items-end space-y-2 ml-4",children:[e.jsx("span",{className:"text-xs text-slate-500 whitespace-nowrap",children:F(s.last_message_time)}),v(s.status)]})]})},s.id)})})]}),o.escalated.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(Ze,{className:"w-5 h-5 text-amber-400"}),e.jsxs("h2",{className:"text-lg font-semibold text-white",children:["Escalated (",o.escalated.length,")"]})]}),e.jsx("div",{className:"space-y-2",children:o.escalated.map(s=>{var h;return e.jsx("button",{onClick:()=>r(`/portal/chat/${s.id}`),className:"w-full bg-slate-800 hover:bg-slate-750 border border-amber-700 rounded-lg p-4 transition-all text-left group",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-amber-500 to-orange-500 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-white font-semibold text-sm",children:(h=s.patient_name)==null?void 0:h.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h3",{className:"text-sm font-semibold text-white truncate",children:s.patient_name}),s.unread_count>0&&e.jsx("span",{className:"inline-flex items-center justify-center w-5 h-5 text-xs font-bold text-white bg-amber-600 rounded-full",children:s.unread_count})]}),e.jsx("p",{className:"text-xs text-slate-400 truncate",children:s.last_message})]})]})}),e.jsxs("div",{className:"flex flex-col items-end space-y-2 ml-4",children:[e.jsx("span",{className:"text-xs text-slate-500 whitespace-nowrap",children:F(s.last_message_time)}),v(s.status)]})]})},s.id)})})]}),o.resolved.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(xe,{className:"w-5 h-5 text-green-400"}),e.jsxs("h2",{className:"text-lg font-semibold text-white",children:["Resolved (",o.resolved.length,")"]})]}),e.jsx("div",{className:"space-y-2",children:o.resolved.map(s=>{var h;return e.jsx("button",{onClick:()=>r(`/portal/chat/${s.id}`),className:"w-full bg-slate-800 hover:bg-slate-750 border border-slate-700 rounded-lg p-4 transition-all text-left group opacity-75",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-500 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-white font-semibold text-sm",children:(h=s.patient_name)==null?void 0:h.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-sm font-semibold text-white truncate",children:s.patient_name}),e.jsx("p",{className:"text-xs text-slate-400 truncate",children:s.last_message})]})]})}),e.jsxs("div",{className:"flex flex-col items-end space-y-2 ml-4",children:[e.jsx("span",{className:"text-xs text-slate-500 whitespace-nowrap",children:F(s.last_message_time)}),v(s.status)]})]})},s.id)})})]})]}),k&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-lg max-w-md w-full",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-slate-700",children:[e.jsx("h2",{className:"text-xl font-semibold text-white",children:"Simulate New Chat"}),e.jsx("button",{onClick:()=>w(!1),className:"text-slate-400 hover:text-white transition-colors",children:e.jsx(ue,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:["Patient ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsxs("select",{value:_,onChange:s=>U(s.target.value),className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary",children:[e.jsx("option",{value:"",children:"Select patient"}),u.map(s=>e.jsx("option",{value:s.id,children:s.full_name},s.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:["Initial Message ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("textarea",{value:y,onChange:s=>b(s.target.value),rows:4,placeholder:"Enter the patient's initial message...",className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary resize-none"})]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 px-6 py-4 border-t border-slate-700",children:[e.jsx("button",{onClick:()=>w(!1),className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors",disabled:C,children:"Cancel"}),e.jsxs("button",{onClick:D,disabled:C||!_||!y.trim(),className:"inline-flex items-center px-4 py-2 bg-primary hover:bg-opacity-80 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),C?"Creating...":"Create Chat"]})]})]})})]})},Ds=()=>{var d,p,P,S,$;const{sessionId:r}=ne(),i=G(),{organization:t,user:a}=V(),[g,I]=n.useState(null),[k,w]=n.useState([]),[u,j]=n.useState(!0),[_,U]=n.useState(""),[y,b]=n.useState(!1),[C,T]=n.useState(!1),A=n.useRef(null),l=n.useRef(null);n.useEffect(()=>(r&&(t!=null&&t.id)&&(v(),F()),()=>{l.current&&x.removeChannel(l.current)}),[r,t==null?void 0:t.id]),n.useEffect(()=>{D()},[k]);const D=()=>{var m;(m=A.current)==null||m.scrollIntoView({behavior:"smooth"})},v=()=>L(void 0,null,function*(){try{j(!0);const{data:m,error:E}=yield x.from("chat_sessions").select("*").eq("id",r).eq("organization_id",t.id).maybeSingle();if(E)throw E;if(!m){q.error("Chat session not found"),i("/portal/chat");return}const{data:M}=yield x.from("patients").select("full_name, age, gender").eq("id",m.patient_id).maybeSingle();I(O(R({},m),{patient_name:(M==null?void 0:M.full_name)||"Unknown Patient",patient_info:{age:M==null?void 0:M.age,gender:M==null?void 0:M.gender}}));const{data:B,error:z}=yield x.from("messages").select("*").eq("chat_session_id",r).order("created_at",{ascending:!0});if(z)throw z;const Y=yield Promise.all((B||[]).map(J=>L(void 0,null,function*(){if(J.sender_id&&J.sender_type!=="bot"){const{data:ae}=yield x.from("users").select("full_name").eq("id",J.sender_id).maybeSingle();return O(R({},J),{sender_name:(ae==null?void 0:ae.full_name)||"Unknown"})}return O(R({},J),{sender_name:J.sender_type==="bot"?"AI Assistant":"Unknown"})})));w(Y)}catch(m){console.error("Error loading chat data:",m),q.error("Failed to load chat")}finally{j(!1)}}),F=()=>{const m=x.channel(`chat-${r}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`chat_session_id=eq.${r}`},E=>L(void 0,null,function*(){const M=E.new;let B="Unknown";if(M.sender_id&&M.sender_type!=="bot"){const{data:z}=yield x.from("users").select("full_name").eq("id",M.sender_id).maybeSingle();B=(z==null?void 0:z.full_name)||"Unknown"}else M.sender_type==="bot"&&(B="AI Assistant");w(z=>[...z,O(R({},M),{sender_name:B})])})).subscribe();l.current=m},o=m=>L(void 0,null,function*(){if(m.preventDefault(),!(!_.trim()||y))try{b(!0);const{error:E}=yield x.from("messages").insert([{chat_session_id:r,sender_type:"human",sender_id:a.id,content:_.trim()}]);if(E)throw E;yield x.from("chat_sessions").update({updated_at:new Date().toISOString()}).eq("id",r),U("")}catch(E){console.error("Error sending message:",E),q.error("Failed to send message")}finally{b(!1)}}),s=()=>L(void 0,null,function*(){if(!(!g||g.status==="escalated"))try{T(!0);const{error:m}=yield x.from("chat_sessions").update({status:"escalated"}).eq("id",r);if(m)throw m;const{data:E}=yield x.from("org_staff").select("id").eq("user_id",a.id).eq("organization_id",t.id).maybeSingle(),{error:M}=yield x.from("escalations").insert([{chat_session_id:r,assigned_staff_id:(E==null?void 0:E.id)||null,priority:"medium",status:"open"}]);if(M)throw M;I(B=>B?O(R({},B),{status:"escalated"}):null),q.success("Chat escalated to doctor")}catch(m){console.error("Error escalating chat:",m),q.error("Failed to escalate chat")}finally{T(!1)}}),h=m=>{switch(m){case"patient":return e.jsx(X,{className:"w-4 h-4"});case"bot":return e.jsx(we,{className:"w-4 h-4"});case"doctor":return e.jsx(ss,{className:"w-4 h-4"});case"human":case"staff":return e.jsx(de,{className:"w-4 h-4"});default:return e.jsx(X,{className:"w-4 h-4"})}},c=m=>{switch(m){case"patient":return"bg-blue-500";case"bot":return"bg-purple-500";case"doctor":return"bg-green-500";case"human":case"staff":return"bg-slate-500";default:return"bg-slate-500"}},N=m=>m.sender_type==="human"&&m.sender_id===(a==null?void 0:a.id),f=m=>{const E={active:"bg-blue-900 text-blue-300 border-blue-700",escalated:"bg-amber-900 text-amber-300 border-amber-700",resolved:"bg-green-900 text-green-300 border-green-700"},M={active:e.jsx(xe,{className:"w-3 h-3"}),escalated:e.jsx(le,{className:"w-3 h-3"}),resolved:e.jsx(xe,{className:"w-3 h-3"})};return e.jsxs("span",{className:`inline-flex items-center space-x-1 px-2 py-1 text-xs font-medium rounded border ${E[m]||E.active}`,children:[M[m],e.jsx("span",{children:m.charAt(0).toUpperCase()+m.slice(1)})]})};return u?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400",children:"Loading chat..."})]})}):g?e.jsxs("div",{className:"flex flex-col h-[calc(100vh-12rem)] max-w-6xl mx-auto",children:[e.jsx("div",{className:"bg-slate-800 border border-slate-700 rounded-t-lg px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:()=>i("/portal/chat"),className:"text-slate-400 hover:text-white transition-colors",children:e.jsx(se,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-primary rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-semibold text-sm",children:(d=g.patient_name)==null?void 0:d.charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:g.patient_name}),e.jsxs("div",{className:"flex items-center space-x-2 text-xs text-slate-400",children:[((p=g.patient_info)==null?void 0:p.age)&&e.jsxs("span",{children:[g.patient_info.age," years"]}),((P=g.patient_info)==null?void 0:P.age)&&((S=g.patient_info)==null?void 0:S.gender)&&e.jsx("span",{children:"•"}),(($=g.patient_info)==null?void 0:$.gender)&&e.jsx("span",{children:g.patient_info.gender.charAt(0).toUpperCase()+g.patient_info.gender.slice(1)})]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[f(g.status),g.status!=="escalated"&&g.status!=="resolved"&&e.jsxs("button",{onClick:s,disabled:C,className:"inline-flex items-center px-3 py-2 bg-amber-900 hover:bg-amber-800 text-amber-300 border border-amber-700 rounded-lg transition-colors text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),C?"Escalating...":"Escalate to Doctor"]})]})]})}),e.jsxs("div",{className:"flex-1 bg-slate-900 border-x border-slate-700 overflow-y-auto p-6 space-y-4",children:[k.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 bg-slate-800 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(we,{className:"w-8 h-8 text-slate-500"})}),e.jsx("p",{className:"text-slate-400 mb-2",children:"No messages yet"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Start the conversation"})]}):k.map(m=>{const E=N(m),M=m.sender_type==="patient";return e.jsx("div",{className:`flex ${E||!M?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`flex items-start space-x-2 max-w-2xl ${E||!M?"flex-row-reverse space-x-reverse":""}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${c(m.sender_type)} text-white`,children:h(m.sender_type)}),e.jsxs("div",{className:`flex flex-col ${E||!M?"items-end":"items-start"}`,children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx("span",{className:"text-xs font-medium text-slate-400",children:m.sender_name}),e.jsx("span",{className:"text-xs text-slate-500",children:new Date(m.created_at).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})})]}),e.jsx("div",{className:`px-4 py-2 rounded-lg ${E||!M?"bg-primary text-white rounded-br-none":"bg-slate-800 text-slate-200 rounded-bl-none border border-slate-700"}`,children:e.jsx("p",{className:"text-sm whitespace-pre-wrap break-words",children:m.content})})]})]})},m.id)}),e.jsx("div",{ref:A})]}),e.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-b-lg px-6 py-4",children:[e.jsxs("form",{onSubmit:o,className:"flex items-end space-x-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx("textarea",{value:_,onChange:m=>U(m.target.value),onKeyDown:m=>{m.key==="Enter"&&!m.shiftKey&&(m.preventDefault(),o(m))},placeholder:"Type your message...",rows:1,className:"w-full px-4 py-3 bg-slate-900 border border-slate-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary resize-none",disabled:y})}),e.jsx("button",{type:"submit",disabled:!_.trim()||y,className:"p-3 bg-primary hover:bg-opacity-80 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex-shrink-0",children:e.jsx(es,{className:"w-5 h-5"})})]}),e.jsx("p",{className:"text-xs text-slate-500 mt-2",children:"Press Enter to send, Shift + Enter for new line"})]})]}):e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-slate-400",children:"Chat session not found"})})},Ls=()=>{const r=G(),{organization:i,user:t}=V(),[a,g]=n.useState([]),[I,k]=n.useState(!0),[w,u]=n.useState("my"),[j,_]=n.useState(!1),[U,y]=n.useState(""),[b,C]=n.useState(null);n.useEffect(()=>{i!=null&&i.id&&(t!=null&&t.id)&&T()},[i==null?void 0:i.id,t==null?void 0:t.id]),n.useEffect(()=>{U&&A()},[U,w]);const T=()=>L(void 0,null,function*(){try{const{data:s,error:h}=yield x.from("org_staff").select("id, can_handle_escalations").eq("organization_id",i.id).eq("user_id",t.id).maybeSingle();if(h)throw h;s&&(y(s.id),_(s.can_handle_escalations||!1))}catch(s){console.error("Error loading staff permissions:",s)}}),A=()=>L(void 0,null,function*(){try{k(!0);let s=x.from("escalations").select("*, chat_sessions!inner(organization_id, patient_id)").eq("chat_sessions.organization_id",i.id).order("created_at",{ascending:!1});w==="my"&&(s=s.eq("assigned_staff_id",U));const{data:h,error:c}=yield s;if(c)throw c;const N=yield Promise.all((h||[]).map(f=>L(void 0,null,function*(){var S,$;const[d,p]=yield Promise.all([x.from("patients").select("full_name").eq("id",f.chat_sessions.patient_id).maybeSingle(),f.assigned_staff_id?x.from("org_staff").select("user_id").eq("id",f.assigned_staff_id).maybeSingle():Promise.resolve({data:null})]);let P="Unassigned";if((S=p.data)!=null&&S.user_id){const{data:m}=yield x.from("users").select("full_name").eq("id",p.data.user_id).maybeSingle();P=(m==null?void 0:m.full_name)||"Unknown"}return{id:f.id,chat_session_id:f.chat_session_id,assigned_staff_id:f.assigned_staff_id,priority:f.priority,status:f.status,created_at:f.created_at,patient_name:(($=d.data)==null?void 0:$.full_name)||"Unknown Patient",assigned_to_name:P,patient_id:f.chat_sessions.patient_id}})));g(N)}catch(s){console.error("Error loading escalations:",s),q.error("Failed to load escalations")}finally{k(!1)}}),l=s=>L(void 0,null,function*(){try{C(s.id);const{error:h}=yield x.from("escalations").update({assigned_staff_id:U,status:"in_progress"}).eq("id",s.id);if(h)throw h;q.success("Escalation assigned to you"),A()}catch(h){console.error("Error assigning escalation:",h),q.error("Failed to assign escalation")}finally{C(null)}}),D=s=>L(void 0,null,function*(){if(confirm("Are you sure you want to mark this escalation as resolved?"))try{C(s.id);const{error:h}=yield x.from("escalations").update({status:"resolved",resolved_at:new Date().toISOString()}).eq("id",s.id);if(h)throw h;const{error:c}=yield x.from("chat_sessions").update({status:"resolved"}).eq("id",s.chat_session_id);if(c)throw c;q.success("Escalation marked as resolved"),A()}catch(h){console.error("Error resolving escalation:",h),q.error("Failed to resolve escalation")}finally{C(null)}}),v=s=>{const h={low:"bg-slate-900 text-slate-300 border-slate-700",medium:"bg-amber-900 text-amber-300 border-amber-700",high:"bg-red-900 text-red-300 border-red-700"};return e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded border ${h[s]||h.medium}`,children:s.charAt(0).toUpperCase()+s.slice(1)})},F=s=>{const h={open:"bg-blue-900 text-blue-300 border-blue-700",in_progress:"bg-amber-900 text-amber-300 border-amber-700",resolved:"bg-green-900 text-green-300 border-green-700"};return e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded border ${h[s]||h.open}`,children:s==="in_progress"?"In Progress":s.charAt(0).toUpperCase()+s.slice(1)})},o=s=>{const h=new Date,c=new Date(s),N=Math.floor((h.getTime()-c.getTime())/1e3);return N<60?"Just now":N<3600?`${Math.floor(N/60)}m ago`:N<86400?`${Math.floor(N/3600)}h ago`:N<604800?`${Math.floor(N/86400)}d ago`:c.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})};return I?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400",children:"Loading escalations..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Escalations"}),e.jsx("p",{className:"text-slate-400",children:"Manage patient escalations and urgent support requests"})]}),e.jsx("div",{className:"bg-slate-800 border border-slate-700 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ge,{className:"w-5 h-5 text-slate-400"}),e.jsx("span",{className:"text-sm font-medium text-white",children:"Filter"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>u("my"),className:`px-4 py-2 text-sm font-medium rounded-lg transition-colors ${w==="my"?"bg-primary text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"}`,children:"My Escalations"}),j&&e.jsx("button",{onClick:()=>u("all"),className:`px-4 py-2 text-sm font-medium rounded-lg transition-colors ${w==="all"?"bg-primary text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"}`,children:"All Escalations"})]})]})}),a.length===0?e.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-lg p-12 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-slate-700 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(le,{className:"w-8 h-8 text-slate-500"})}),e.jsx("p",{className:"text-slate-400 mb-2",children:w==="my"?"No escalations assigned to you":"No escalations available"}),e.jsx("p",{className:"text-sm text-slate-500",children:w==="my"?"Escalations assigned to you will appear here":"All escalations will appear here"})]}):e.jsx("div",{className:"bg-slate-800 border border-slate-700 rounded-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-900 border-b border-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-300 uppercase tracking-wider",children:"Patient"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-300 uppercase tracking-wider",children:"Priority"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-300 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-300 uppercase tracking-wider",children:"Assigned To"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-300 uppercase tracking-wider",children:"Created"}),e.jsx("th",{className:"px-6 py-4 text-right text-xs font-semibold text-slate-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-700",children:a.map(s=>{var h;return e.jsxs("tr",{className:"hover:bg-slate-750 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-amber-500 to-orange-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-semibold text-xs",children:(h=s.patient_name)==null?void 0:h.charAt(0).toUpperCase()})}),e.jsx("span",{className:"text-sm font-medium text-white",children:s.patient_name})]})}),e.jsx("td",{className:"px-6 py-4",children:v(s.priority)}),e.jsx("td",{className:"px-6 py-4",children:F(s.status)}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`text-sm ${s.assigned_staff_id?"text-slate-300":"text-slate-500 italic"}`,children:s.assigned_to_name})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-slate-400",children:[e.jsx(te,{className:"w-4 h-4"}),e.jsx("span",{children:o(s.created_at)})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[!s.assigned_staff_id&&s.status!=="resolved"&&e.jsxs("button",{onClick:()=>l(s),disabled:b===s.id,className:"inline-flex items-center px-3 py-1.5 text-sm font-medium text-blue-300 bg-blue-900 hover:bg-blue-800 border border-blue-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ts,{className:"w-4 h-4 mr-1"}),"Assign to Me"]}),e.jsxs("button",{onClick:()=>r(`/portal/chat/${s.chat_session_id}`),className:"inline-flex items-center px-3 py-1.5 text-sm font-medium text-green-300 bg-green-900 hover:bg-green-800 border border-green-700 rounded-lg transition-colors",children:[e.jsx(me,{className:"w-4 h-4 mr-1"}),"View Chat"]}),s.status!=="resolved"&&e.jsxs("button",{onClick:()=>D(s),disabled:b===s.id,className:"inline-flex items-center px-3 py-1.5 text-sm font-medium text-emerald-300 bg-emerald-900 hover:bg-emerald-800 border border-emerald-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(De,{className:"w-4 h-4 mr-1"}),"Resolve"]})]})})]},s.id)})})]})})})]})},$s=()=>e.jsx(bs,{children:e.jsxs(Fe,{children:[e.jsx(W,{path:"/",element:e.jsx(fs,{})}),e.jsx(W,{path:"/patients",element:e.jsx(js,{})}),e.jsx(W,{path:"/patients/:id",element:e.jsx(ws,{})}),e.jsx(W,{path:"/consultations",element:e.jsx(_s,{})}),e.jsx(W,{path:"/consultations/new",element:e.jsx(ke,{})}),e.jsx(W,{path:"/consultations/:id",element:e.jsx(ke,{})}),e.jsx(W,{path:"/consultations/:id/prescription",element:e.jsx(Ss,{})}),e.jsx(W,{path:"/consultations/:id/lab-order",element:e.jsx(Pe,{})}),e.jsx(W,{path:"/prescriptions/:id",element:e.jsx(Cs,{})}),e.jsx(W,{path:"/lab-orders",element:e.jsx(ks,{})}),e.jsx(W,{path:"/lab-orders/new",element:e.jsx(Pe,{})}),e.jsx(W,{path:"/lab-orders/:id/upload",element:e.jsx(Ps,{})}),e.jsx(W,{path:"/chat",element:e.jsx(qs,{})}),e.jsx(W,{path:"/chat/:sessionId",element:e.jsx(Ds,{})}),e.jsx(W,{path:"/escalations",element:e.jsx(Ls,{})})]})});export{Vs as AdminDashboard,Bs as Landing,zs as Login,$s as PortalDashboard};
